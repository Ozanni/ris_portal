import{a as e,ao as _,F as R,j as E,S as B,aF as w,aG as b,ag as T,r as f,C as I,bd as k}from"./vendor-1c7a9a47.js";import{bj as p,e5 as P,dm as j,ex as S,ed as y,c8 as g,g4 as C,dn as O,bc as A,e_ as F,cj as x,ca as D,b9 as N,bD as q,cR as U,dM as Q,bm as V,gm as M,c2 as W,f6 as L,be as H,cb as $,f7 as K,ck as X,f9 as J,fa as Y,fb as Z}from"./index-cdd5c634.js";import{a as ee,b as se,c as te,d as oe,e as re,u as ne}from"./role-14050e4a.js";const ie=a=>{const{control:r,readonly:t}=a,o=p(),[s]=ee(),d=r._formValues.id,n=async()=>{var c;return((c=(await s({filter:{}},!0)).data)==null?void 0:c.list)??[]};return e(P,{name:"id",control:r,required:!0,MySelectProps:{label:o.resources.role.id(),disabled:t},disableValue:d,onGetListRecord:n,renderSelectField:({listData:c,formSelectFieldProps:u})=>e(j,{...u,children:c.map(i=>e(_,{value:(i==null?void 0:i.id)||"",children:i.name},i.id))})})},v=a=>{const{control:r,onKeyDown:t,record:o}=a,s=p();return e(R,{children:E(B,{spacing:1,alignItems:"start",width:"500px",children:[e(ie,{readonly:!!o,control:r}),e(S,{name:"name",control:r,MyTextFieldProps:{label:s.resources.role.name(),placeholder:s.resources.role.name(),fullWidth:!0,required:!0,size:"small",onKeyDown:t}}),e(S,{name:"description",control:r,MyTextFieldProps:{label:s.resources.role.description(),placeholder:s.resources.role.description(),fullWidth:!0,size:"small",onKeyDown:t,multiline:!0,rows:3}})]})})},ae=a=>{const{onSuccessCallback:r}=a,t=y(),o=p(),[s]=se(),d=g("success",o.messages.titles.createResource({resource:o.resources.role.title().toLowerCase()})),n=g("error",o.messages.titles.createResource({resource:o.resources.role.title().toLowerCase()})),c={mode:"onBlur",criteriaMode:"all",resolver:w(b.object({id:b.string().trim().min(1,o.messages.validation.genericRequired({resource:o.resources.role.id()})),name:b.string().trim().min(C,o.messages.validation.genericMinLength({resource:o.resources.role.name(),length:C})),description:b.string().optional().nullable()})),defaultValues:{name:"",id:"",description:null}};return e(O,{registerFormFunctions:i=>t("submitCreateForm",()=>i.submit&&i.submit()),onSubmit:async i=>{try{const l={id:i.id??"",name:i.name??"",description:i.description??null};"error"in await s(l)?n():(d(),r&&r())}catch{n()}},submitOnEnter:!0,formOptions:c,renderInputs:i=>e(v,{...i})})},le=()=>{const{isOpen:a,open:r,close:t}=A(!1);return y()("openCreateModal",r),e(T,{open:a,children:e(z,{closeModal:t})})},z=a=>{const{closeModal:r}=a,t=p(),o=F();return e(x,{confirmLabel:t.buttons.create(),handleClose:r,BodyComponent:e(ae,{onSuccessCallback:r}),handleConfirm:()=>o.submitCreateForm(),title:t.messages.titles.createResource({resource:t.resources.role.title().toLowerCase()})})};z.displayName="RoleCreateModal";const ce=a=>{const{onSuccessCallback:r,record:t}=a,o=y(),s=p(),[d]=te(),n=g("success",s.messages.titles.editResource({resource:s.resources.role.title().toLowerCase()})),c=g("error",s.messages.titles.editResource({resource:s.resources.role.title().toLowerCase()})),u={mode:"onBlur",criteriaMode:"all",resolver:w(b.object({id:b.string().trim().min(1,s.messages.validation.genericRequired({resource:s.resources.role.id()})),name:b.string().trim().min(C,s.messages.validation.genericMinLength({resource:s.resources.role.name(),length:C})),description:b.string().optional().nullable()})),defaultValues:{id:t.id,name:t.name,description:t.description}};return e(O,{registerFormFunctions:l=>o("submitEditForm",()=>l.submit&&l.submit()),onSubmit:async l=>{try{const m={id:l.id??"",name:l.name??"",description:l.description??""};"error"in await d(m)?c():(n(),r&&r())}catch{c()}},submitOnEnter:!0,formOptions:u,renderInputs:l=>e(v,{record:t,...l})})},de=()=>{const{isOpen:a,open:r,close:t}=A(!1),o=N(q(U.ROLE)),{data:s}=oe(o?{id:o==null?void 0:o.id}:k.skipToken),[d]=re(),n=p(),c=Q(),u=y();u("openEditModal",r);const i=g("success",n.messages.titles.deleteResource({resource:n.resources.role.title().toLowerCase()})),l=g("error",n.messages.titles.deleteResource({resource:n.resources.role.title().toLowerCase()})),m=f.useCallback(()=>{s&&c({message:`${n.messages.notification.deleteRole({name:`${s==null?void 0:s.name}`})}`,options:{variant:"warning",onConfirm:async()=>{"error"in await d({id:s.id})?l():(i(),t())}}})},[t,d,l,c,i,s,n.messages.notification]);return u("submitDelete",()=>m()),s?e(T,{disableEnforceFocus:!0,open:a,children:e(G,{record:s,closeModal:t})}):e(R,{})},G=f.forwardRef((a,r)=>{const{closeModal:t,record:o}=a,s=p(),d=F();return e(R,{children:e(x,{ref:r,confirmLabel:s.buttons.update(),handleConfirm:()=>d.submitEditForm(),handleClose:t,BodyComponent:o?e(ce,{record:o,onSuccessCallback:t}):e(D,{children:e(I,{})}),title:s.messages.titles.editResource({resource:s.resources.role.title().toLowerCase()})})})});G.displayName="RoleEditModal";const ue=a=>{const{FilterComponent:r,permission:t}=a,o=p(),s=F(),d=N(V(M)),{data:n,isFetching:c,refetch:u}=ne(d||k.skipToken),{open:i}=W(),l=f.useMemo(()=>[{type:"custom",getColumnDef:m=>m.display({id:"stt",header:o.messages.stt(),cell:h=>e(D,{children:h.row.index+1}),minSize:L,maxSize:L})},{type:"record",name:"id",headerLabel:"ID",columnDefOptions:{size:200},enableSort:!0},{type:"record",name:"name",headerLabel:o.resources.role.name(),columnDefOptions:{size:650}},{type:"record",name:"description",headerLabel:o.resources.role.description(),columnDefOptions:{size:760}}],[o.messages,o.resources.role]);return e(H,{children:e($,{tableId:M,data:n==null?void 0:n.list,FilterComponent:r,tableColumnsDescription:l,MyDataGridProps:{isLoading:c,onRowRightClick:m=>{i(m)},onRowDoubleClick(){t!=null&&t.isSysadmin&&s.openEditModal()}},paginationControls:{totalRecords:n==null?void 0:n.meta.totalRecords,pageSize:n==null?void 0:n.list.length},TanstackTableOptions:{enableRowSelection:!0,enableMultiRowSelection:!1},renderActionButtons:()=>e(K,{disabled:!(t!=null&&t.isSysadmin),tableId:M,refetch:u})})})},ge=()=>{const a=p(),r=X();return E(J,{children:[e(Y,{title:a.resources.role.title(),ActionButtons:e(R,{}),TableComponent:e(ue,{permission:r,FilterComponent:void 0})}),e(le,{}),e(de,{}),e(Z,{disabled:!(r!=null&&r.isSysadmin)})]})};export{ge as AdminRole};
