import{a as e,Z as le,F as y,r as I,s as D,j as g,S as U,aB as ce,T as L,W as Ne,J as xe,ag as F,bd as Ue,bw as qe,l as Fe,an as _e,aV as Ve}from"./vendor-1c7a9a47.js";import{b6 as ze,b7 as ne,b8 as Ge,b9 as R,ba as de,bb as P,bc as B,bd as ue,be as Qe,bf as A,bg as K,bh as He,bi as pe,bj as m,bk as Ke,bl as me,bm as he,bn as T,bo as We,bp as $e,bq as re,br as _,bs as se,bt as be,bu as Ye,bv as V,bw as je,bx as Je,by as Xe,bz as Ze,bA as et,bB as tt,bC as ot,bD as Z,bE as W,bF as Ce,bG as nt,bH as rt,bI as q,bJ as w,bK as st,bL as ge,bM as it,bN as at,bO as lt,bP as O,bQ as ct,bR as dt,bS as ut,bT as pt,bU as E,bV as mt,bW as ht,bX as bt,bY as Ct,bZ as gt,b_ as It,b$ as yt,c0 as Ie,c1 as St,c2 as ye,c3 as ft,c4 as Mt,c5 as Ot,c6 as Rt,c7 as Tt,c8 as ie,c9 as Dt,ca as x,cb as ee,cc as wt,cd as kt,ce as N,cf as Q,cg as vt,ch as Et,ci as Lt,cj as $,ck as Pt,cl as Bt,cm as At,cn as Se,co as fe,cp as Nt,cq as xt,cr as Me,cs as Ut,ct as qt,cu as Ft,cv as _t,cw as z,cx as G,cy as Vt,cz as zt,cA as Gt,cB as Qt,cC as Ht,cD as Kt,cE as Wt,cF as $t,cG as Yt,cH as jt,cI as Jt,cJ as Xt,j as v,cK as Zt,cL as eo,cM as Y,cN as j,cO as to,h as Oe,cP as oo,cQ as no,cR as k,cS as ro,cT as Re,cU as H,cV as Te,cW as so,cX as io,i as ao,cY as lo,cZ as co,c_ as De,c$ as X,d0 as uo,d1 as po,d2 as mo,d3 as ho,d4 as bo,d5 as Co,e as go,d6 as Io,d7 as yo,d8 as So,d9 as fo,da as Mo,db as Oo,dc as Ro}from"./index-cdd5c634.js";import{O as To,R as we,a as ke,b as Do,c as ve,g as wo,S as ko,M as vo,d as Eo,D as Lo,Q as Po,P as Bo,e as Ao,f as No}from"./RadiologyReportPanelShell-50afb226.js";import{C as xo}from"./CollapsiblePanel-1b32f69e.js";import"./convertPdf-d312bc78.js";const Uo=o=>{const{children:n,value:t,tabValue:r,...s}=o;return e(le,{role:"tabpanel",hidden:t!==r,id:`simple-tabpanel-${r}`,"aria-labelledby":`simple-tab-${r}`,sx:{width:"100%",height:"100%"},...s,children:t===r?n:e(y,{})})},qo=o=>{const{order:n}=o,t=ze(ne.REPORTING,n);return e(Ge,{page:ne.REPORTING,sidepanels:t})},Fo=()=>{const o=R(de),{data:n}=P({id:o??0},{skip:!o});return e(qo,{order:n},n==null?void 0:n.id)},_o=()=>{const o=B(!1),[n,t]=I.useState();return ue()("openPrintImageModal",i=>{t(i),o.open()}),e(To,{disclosure:o,orderID:n??0})},Vo=o=>{const{TableComponent:n,PanelComponent:t}=o;return e(zo,{children:g(Qe,{children:[e(U,{height:"100%",overflow:"hidden",spacing:2,children:n}),t]})})},zo=D("div")`
  display: flex;
  width: 100%;
  height: 100%;
  max-height: 100%;
  overflow: hidden;
  /* padding: ${o=>o.theme.spacing(1)}; */
  padding-bottom: 0;
`,Go=o=>{const{ReportHeader:n,ReportContent:t}=o;return g(y,{children:[e(Qo,{children:n}),e(Ko,{children:e(Ho,{children:t})})]})},Qo=D("div")`
  width: 100%;
  padding: ${o=>o.theme.spacing(1)};
  border-bottom: 1px solid ${o=>ce(o.theme.palette.text.primary,.7)};
`,Ho=D("div")`
  min-height: 350px;
`,Ko=D("div")`
  position: relative;
  width: 100%;
  height: 100%;
  max-width: 100%;
  max-height: 100%;
  display: grid;
  padding: ${o=>o.theme.spacing(1)};
  gap: ${o=>o.theme.spacing(1.5)};
  overflow: auto;
`,Wo=({orderID:o})=>{var c;const n=A(),t=R(K(o)),{data:r}=P({id:o}),s=(c=r==null?void 0:r.requests)==null?void 0:c.find(a=>a.id===t);return s!=null&&s.finalReportID&&n(He({orderID:o,activeReportID:s.finalReportID})),e(we,{orderID:o,callbacks:{onReportApproved:()=>{},onClose:()=>{}},ReportComponent:e(Go,{ReportHeader:e(ke,{ActionButtons:e(Do,{})}),ReportContent:e(ve,{isQuickReportTab:!0,onRequestChange:a=>{o&&n(pe({orderID:o,requestID:a.id}))}})})})},$o=()=>{var b,C,h;const{isOpen:o,open:n,close:t}=B(!0),r=m(),s=A(),i=R(de),c=R(Ke),{data:a}=P({id:i??0},{skip:!i});return i?c?e(xo,{initialExpanded:o,onExpand:n,onClose:()=>s(me()),onCollapse:t,title:r.buttons.quickReport()+"-"+r.pages.orderList.orderPanelTitle({patientAge:wo((b=a==null?void 0:a.patient)==null?void 0:b.birthDate).toString(),patientName:((C=a==null?void 0:a.patient)==null?void 0:C.fullname)??"",pid:((h=a==null?void 0:a.patient)==null?void 0:h.pid)??""}),children:e(Yo,{orderID:i})},i):e(y,{}):e(y,{})},Yo=({orderID:o})=>e(jo,{children:e(Wo,{orderID:o})}),jo=D(U)`
  width: 100%;
  height: 100%;
  border: 1px solid #bdbdbd;
`,Jo=()=>{const o=R(he(T)),{data:n}=We({filter:{}}),t=A(),r=m(),s=I.useMemo(()=>$e(n==null?void 0:n.list),[n==null?void 0:n.list]),i=I.useMemo(()=>{const b=[{MyTreeItemProps:{nodeId:re,label:r.pages.orderList.selectAllOrder(),ContentProps:{labelCollapsedIcon:e(_,{color:"primary"}),labelIcon:e(_,{color:"primary"})}}}];return s.forEach((C,h)=>{const f={MyTreeItemProps:{nodeId:h,label:h.replace(se,""),ContentProps:{labelCollapsedIcon:e(_,{color:"primary"}),labelIcon:e(_,{color:"primary"})}},children:C.map(M=>({MyTreeItemProps:{nodeId:be(M.id),label:M.name,ContentProps:{labelIcon:e(Ye,{color:"primary"})}}}))};b.push(f)}),b},[s,r.pages.orderList]),c=I.useCallback((b,C)=>{if(C===re){t(V({tableId:T,filter:{modalityIDs:n==null?void 0:n.list.map(h=>h.id)},merge:!0}));return}if(C.includes(se)){const h=s.get(C);t(V({tableId:T,filter:{modalityIDs:h==null?void 0:h.map(f=>f.id)},merge:!0}))}else{const h=C.replace(je,"");t(V({tableId:T,filter:{modalityIDs:[parseInt(h)]},merge:!0}))}},[t,s,n==null?void 0:n.list]);I.useEffect(()=>{var b;n!=null&&n.list.length&&!((b=o==null?void 0:o.filter.modalityIDs)!=null&&b.length)&&t(V({tableId:T,filter:{modalityIDs:n==null?void 0:n.list.map(C=>C.id)},merge:!0}))},[t,n==null?void 0:n.list,o]);const a=Array.from(s.keys());return e(Je,{title:r.pages.orderList.sidebarHeader(),collapsible:!0,MenuCollapse:e(Xe,{trees:i,handleNodeSelect:c,currentSelected:ae((o==null?void 0:o.filter.modalityIDs)||[],s)}),children:n?g(U,{height:"100%",justifyContent:"space-between",children:[e(Ze,{trees:i,multiSelect:!1,defaultExpanded:a,onNodeSelect:c,selected:ae((o==null?void 0:o.filter.modalityIDs)||[],s)}),g("div",{children:[e(et,{tableID:T}),e(tt,{tableID:T})]})]}):e(y,{})})},ae=(o,n)=>{var t;if(o.length){if(o.length===1)return be(o[0]);{const r=(c,a)=>c-a,s=o.slice().sort(r),i=n.keys();for(const c of i){const a=(t=n.get(c))==null?void 0:t.map(b=>b.id).sort(r);if(a&&a.join()===s.join())return c}}}},Xo=()=>{const o=R(ot),n=R(Z(T)),t=W(),r=Ce({order:n}),{onClick:s}=nt(n),i=I.useCallback(async()=>{r(),s()},[r,s]);return I.useCallback(a=>{switch(o==null?void 0:o.type){case"IMAGING_DOCTOR":i();break;default:t.openStudyInfoModal(a.id)}},[i,t,o==null?void 0:o.type])},Zo=(o={})=>{const{fisrtOrder:n,secondOrder:t}=o,r=!!(n!=null&&n.study&&(t!=null&&t.study)),s=n==null?void 0:n.id,i=t==null?void 0:t.id,c=s&&i&&i!==s?[s,i]:[],{openInNewTab:a}=rt({orderIDs:c});return{menuState:c.length>0&&r?q.ACTIVE:q.DISABLED,openInNewTab:a}},en=({metadata:o,closeMenu:n})=>{const t=m(),r=R(Z(T)),{menuState:s,openInNewTab:i}=Zo({fisrtOrder:r,secondOrder:o});return e(w,{MenuItemProps:{disabled:s===q.DISABLED,onClick:()=>{n(),i()}},IconComponent:e(st,{fontSize:"small",color:"inherit"}),MainComponent:e(L,{color:"inherit",children:t.buttons.compareOrder()})})},tn=({metadata:o,closeMenu:n})=>{const t=m(),{deletable:r,deleteLockOrder:s}=ge(o.id);return e(w,{IconComponent:e(it,{fontSize:"small",color:"inherit"}),MenuItemProps:{onClick:()=>{n(),s()},disabled:!r},MainComponent:t.pages.orderReport.actions.deleteLock()})},on=({order:o,closeMenu:n})=>{const t=m(),{buttonIsActive:r,iconColor:s,handleDeleteOrder:i}=at(o,n);return e(w,{MenuItemProps:{disabled:!r,onClick:()=>i()},IconComponent:e(lt,{fontSize:"small",color:s}),MainComponent:e(L,{children:t.buttons.deleteOrder()}),hotkeyString:O.ORDER_DELETE.title})},nn=({order:o,closeMenu:n})=>{const t=m(),{buttonIsActive:r,iconColor:s,handleClickOpenNewTab:i}=ct(o,n);return e(w,{MenuItemProps:{disabled:!r,onClick:()=>{i(),n()}},IconComponent:e(dt,{fontSize:"small",color:s}),MainComponent:e(L,{children:t.buttons.dowloadDicomImage()}),hotkeyString:O.DOWNLOAD_DICOM_IMAGE.title})},rn=({metadata:o,closeMenu:n})=>{const t=m(),r=Ce({order:o,callbackFunc:n});return e(w,{IconComponent:e(ut,{fontSize:"small",color:"inherit"}),MenuItemProps:{onClick:r,disabled:!o},MainComponent:t.buttons.openOrder(),hotkeyString:O.OPEN_ORDER.title})},sn=o=>{const{order:n,closeMenu:t}=o,r=m(),{buttonIsActive:s,iconColor:i,openMergeStudyModal:c}=pt(n),a=()=>{t(),c()};return E(O.MERGE_STUDY.key,()=>a(),{disabled:!s}),e(w,{MenuItemProps:{disabled:!s,onClick:a},IconComponent:e(mt,{fontSize:"small",color:i}),MainComponent:r.resources.study.mergeStudyInfo(),hotkeyString:O.MERGE_STUDY.title})},an=o=>{const{order:n,closeMenu:t}=o,r=m(),s=W(),c=ht(n)===q.DISABLED;return e(w,{MenuItemProps:{disabled:c,onClick:()=>{s.openPrintImageModal(n.id),t&&t()}},IconComponent:e(bt,{fontSize:"small",color:c?"disabled":"action"}),MainComponent:e(L,{children:r.buttons.printDicomImage()}),hotkeyString:O.PRINT_DICOM_IMAGE.title})},ln=o=>{const{order:n,closeMenu:t}=o,r=m(),{handleClick:s,disabled:i}=Ct(n,t);return e(w,{IconComponent:e(gt,{fontSize:"small",color:i?"disabled":"action"}),MenuItemProps:{disabled:i,onClick:()=>{s()}},MainComponent:r.bookmark.title(),hotkeyString:O.BOOKMARK.title})},cn=o=>{const{orderID:n,closeMenu:t}=o,r=W(),s=m(),i=()=>{r.openStudyInfoModal(n),t&&t()};return E(O.STUDY_INFO.key,()=>i(),{disabled:!n}),e(w,{IconComponent:e(It,{fontSize:"small",color:"inherit"}),MenuItemProps:{onClick:i},MainComponent:s.buttons.requestInfo(),hotkeyString:O.STUDY_INFO.title})},dn=o=>{const{order:n}=o,{buttonState:t,onListItemClick:r}=yt({orders:[n]}),s=m();return e(w,{MenuItemProps:{disabled:t===q.DISABLED,onClick:r},IconComponent:e(Ie,{fontSize:"small"}),MainComponent:e(L,{children:s.buttons.viewImage()}),hotkeyString:"Alt + V"})},un=o=>{const{menuID:n}=o,t=R(St(n)),{close:r}=ye(n),s=m();return t&&g(ft,{menuID:n,type:"menu",children:[e(dn,{order:t}),e(en,{metadata:t,closeMenu:r}),e(rn,{metadata:t,closeMenu:r}),e(tn,{metadata:t,closeMenu:r}),e(J,{}),e(cn,{orderID:t.id,closeMenu:r}),e(on,{order:t,closeMenu:r}),e(sn,{order:t,closeMenu:r}),e(J,{}),e(an,{order:t,closeMenu:r}),e(nn,{order:t,closeMenu:r}),e(w,{MenuItemProps:{disabled:!0},IconComponent:e(Mt,{fontSize:"small",color:"disabled"}),MainComponent:e(L,{color:"text.disabled",children:s.buttons.printPortal()})}),e(J,{}),e(ln,{order:t,closeMenu:r})]})},J=D(Ne)`
  border-color: ${o=>ce(o.theme.palette.text.primary,.6)};
`,pn={stt:{visible:!0,width:0},reportStatus:{visible:!0,width:0},patientName:{visible:!0,width:0},patientPID:{visible:!0,width:0},modalityType:{visible:!0,width:0},inpatient:{visible:!0,width:0},numOfConsumables:{visible:!0,width:0},studyTime:{visible:!0,width:0},requests:{visible:!0,width:0},bodyPart:{visible:!0,width:0},requestedTime:{visible:!0,width:0},operationTime:{visible:!0,width:0},approvedTime:{visible:!0,width:0},accessionNumber:{visible:!0,width:0},patientGender:{visible:!0,width:0},approver:{visible:!0,width:0},expectedReporter:{visible:!0,width:0},requestedDepartment:{visible:!0,width:0}},mn=()=>{const[o]=Ot(),n=m(),[t]=Rt(),r=Tt(),[s,i]=I.useState(),c=ie("success",n.messages.titles.editResource({resource:n.resources.setting.tableSetting()})),a=ie("error",n.messages.titles.editResource({resource:n.resources.setting.tableSetting()}));return I.useEffect(()=>{(async()=>{const M=await o({id:Dt.OrderTable}).unwrap(),p=M!=null&&M.value?JSON.parse(M.value):pn;i(p)})()},[o]),r("submitUserConfigForm",()=>{try{"error"in t({id:"orderTable",value:JSON.stringify(s),valueType:"JSON"})?a():c()}catch{a()}}),{onChangeColumnVisible:({orderTableSettingKey:f})=>{if(s){const M={visible:!s[f].visible,width:s[f].width},p={...s,[f]:M};i(p)}},orderTableSettingState:s,onChangeColumnWidth:({orderTableSettingKey:f,width:M})=>{if(s){const p={visible:s[f].visible,width:M},d={...s,[f]:p};i(d)}}}},hn=({cell:o,column:n,row:t,onChangeColumnWidth:r})=>{const[s,i]=I.useState(o.row.original.width);return e(x,{children:e(kt,{size:"extrasmall",type:"number",InputProps:{value:s,onBlur:()=>{r({orderTableSettingKey:o.row.original.id,width:s})}},onChange:a=>{a.target.value!==null&&i(parseInt(a.target.value))},sx:{height:"25px",width:"80px"}})})},bn=()=>{const o=m(),{onChangeColumnVisible:n,orderTableSettingState:t,onChangeColumnWidth:r}=mn(),s=I.useMemo(()=>t?Object.entries(t).map(([c,a])=>({id:c,visible:a.visible,width:a.width})):[],[t]),i=I.useMemo(()=>[{type:"custom",getColumnDef:c=>c.display({id:"id",header:"Trường / Cột",cell:a=>e(L,{children:o.resources.setting.orderFieldName({key:a.row.original.id})}),size:200})},{type:"custom",getColumnDef:c=>c.display({id:"stt",header:o.messages.stt(),cell:a=>e(x,{children:a.row.index+1}),maxSize:50})},{type:"custom",getColumnDef:c=>c.display({id:"width",header:"Độ rộng",cell:a=>e(x,{children:e(hn,{...a,onChangeColumnWidth:r})}),size:150})},{type:"custom",getColumnDef:c=>c.display({id:"visible",header:"Trạng thái",cell:a=>e(x,{children:e(xe,{checked:a.row.original.visible,size:"small",onChange:b=>n({orderTableSettingKey:a.row.original.id})})}),size:150})}],[n,r,o.messages]);return e("div",{children:e(ee,{tableId:wt,data:s,tableColumnsDescription:i,TanstackTableOptions:{enableRowSelection:!1,enableMultiRowSelection:!1},hiddenFooter:!0})})},Cn=()=>{const o=m(),n=B();return g(y,{children:[e(N,{title:o.buttons.tableConfig(),onClick:n.open,children:e(Q,{IconComponent:vt})}),n.isOpen&&e(gn,{disclosure:n})]})},gn=({disclosure:o})=>{const n=m(),t=Et(),{close:r,isOpen:s,open:i}=o;return e(Lt,{children:e(F,{open:s,children:e($,{title:"Cấu hình bảng đọc ca",BodyComponent:e(le,{p:1,children:e(bn,{})}),handleClose:r,handleConfirm:()=>t.submitUserConfigForm(),confirmLabel:n.buttons.save(),BoxBodyProps:{padding:0},width:"700px"})})})},In=o=>{const{order:n,renderButton:t}=o,r=A(),s=m(),i=Pt(),c=!n||!(i!=null&&i.userCanLockOrder);return t({onClick:()=>r(me()),title:s.buttons.labelWithKeyBind({buttonName:s.buttons.quickReport(),key:O.QUICK_REPORT.title}),disabled:c})},yn=o=>{const{refetch:n}=o,t=R(Z(T)),r=W(),{onClick:s}=Bt({order:t}),i=!t;return E(O.VIEW_IMAGE.key,()=>{s()},{disabled:!t}),E(O.REFRESH.key,()=>{n&&n()}),E(O.STUDY_INFO.key,()=>{r.openStudyInfoModal(t==null?void 0:t.id)},{disabled:!t}),E(O.MERGE_STUDY.key,()=>{r.openMergeStudyModal(t==null?void 0:t.id)},{disabled:(t==null?void 0:t.creationType)!==At.TAG}),e(Se,{ActionsButton:g(y,{children:[e(fe,{orders:t&&[t],IconComponent:e(Q,{IconComponent:Ie}),enableKeybind:!0}),e(In,{order:t,renderButton:c=>e(N,{...c,children:e(Q,{IconComponent:Nt,IconComponentProps:{color:c.disabled?"disabled":"action"}})})}),e(xt,{order:t,disabled:i,enableKeybind:!0}),e(Cn,{}),n&&e(Me,{refetch:n,enableKeybind:!0})]})})},{StyledOrderTableRow:Sn}=Qt,fn=o=>{if(!o)return!1;const{filter:n}=o,{modalityIDs:t}=n;return!t||!t.length?!1:o},Mn=30*1e3,On=o=>{const{FilterComponent:n}=o,t=m(),r=A(),s=I.useRef(null),i=R(he(T)),c=fn(i),{data:a,isFetching:b,refetch:C}=Ut(c||Ue.skipToken,{pollingInterval:Mn}),{open:h}=ye(T),f=Xo(),M=I.useMemo(()=>{const p=({order:d,children:l})=>e(Sn,{$reportStatus:d.reportStatus,$urgent:d.urgent,children:l});return[{type:"custom",getColumnDef:d=>d.display({id:"stt",header:t.messages.stt(),cell:l=>e(x,{children:e(p,{order:l.row.original,children:l.row.index+1})}),maxSize:50})},{type:"record",name:"reportStatus",headerLabel:t.resources.order.status(),renderCell:d=>e(p,{order:d.row.original,children:e(qt,{order:d.row.original})}),enableSort:!0,columnDefOptions:{maxSize:70}},{type:"custom",getColumnDef:d=>d.display({id:"patientName",header:t.resources.order.patient.fullname.long(),cell:l=>e(p,{order:l.row.original,children:e(Ft,{order:l.row.original})})})},{type:"custom",getColumnDef:d=>d.display({id:"patientPID",header:t.resources.order.patient.pid.long(),cell:l=>{var u,S;return e(p,{order:l.row.original,children:e("div",{title:((u=l.row.original.patient)==null?void 0:u.pid)??"",children:(S=l.row.original.patient)==null?void 0:S.pid})})},size:100})},{type:"record",name:"modalityType",headerLabel:t.resources.order.modalityType.short(),renderCell:d=>e(p,{order:d.row.original,children:d.getValue()}),columnDefOptions:{maxSize:70}},{type:"custom",getColumnDef:d=>d.display({id:"inpatient",header:t.resources.order.inpatient(),cell:l=>{var u,S;return e(p,{order:l.row.original,children:(u=l.row.original)!=null&&u.inpatient&&((S=l.row.original)!=null&&S.inpatient)?1:0})},maxSize:50})},{type:"custom",getColumnDef:d=>d.display({id:"numOfConsumables",header:t.resources.order.numOfConsumables.short(),cell:l=>e(p,{order:l.row.original,children:e(_t,{order:l.row.original})}),maxSize:50})},{type:"custom",getColumnDef:d=>d.display({id:"studyTime",header:t.resources.study.studyDatetime(),cell:l=>{var u,S;return e(p,{order:l.row.original,children:((u=l.row.original.study)==null?void 0:u.studyTime)&&((S=z(l.row.original.study.studyTime))==null?void 0:S.format(G.dateTimeNoSecond))})},size:130})},{type:"custom",getColumnDef:d=>d.display({id:"requests",header:t.resources.order.requests(),cell:l=>e(p,{order:l.row.original,children:e(Vt,{order:l.row.original})})})},{type:"custom",getColumnDef:d=>d.display({id:"bodyPart",header:t.resources.study.bodyPartExamined.title(),cell:l=>{var u;return e(p,{order:l.row.original,children:(u=l.row.original.study)==null?void 0:u.bodyPartExamined})},maxSize:100})},{type:"record",name:"requestedTime",headerLabel:t.resources.order.requestedDate.long(),renderCell:d=>{var l;return e(p,{order:d.row.original,children:(l=z(d.getValue()))==null?void 0:l.format(G.dateTimeNoSecond)})},columnDefOptions:{maxSize:130},enableSort:!0},{type:"custom",getColumnDef:d=>d.display({id:"operationTime",header:t.resources.order.request.operationTime(),cell:l=>{var u;return e(p,{order:l.row.original,children:l.row.original.requests&&l.row.original.requests[0].operationTime?(u=z(l.row.original.requests[0].operationTime))==null?void 0:u.format(G.dateTimeNoSecond):""})},minSize:50,size:130})},{type:"custom",getColumnDef:d=>d.display({id:"approvedTime",header:t.resources.order.approvedTime(),cell:l=>{var u;return e(p,{order:l.row.original,children:l.row.original.requests&&l.row.original.requests[0].finalApprovedTime?(u=z(l.row.original.requests[0].finalApprovedTime))==null?void 0:u.format(G.dateTimeNoSecond):""})},minSize:50,size:130})},{type:"record",name:"accessionNumber",headerLabel:t.resources.order.accessionNumber.long(),renderCell:d=>e(p,{order:d.row.original,children:e("div",{title:d.getValue()??"",children:d.getValue()})}),columnDefOptions:{size:120}},{type:"custom",getColumnDef:d=>d.display({id:"patientGender",header:t.resources.order.patient.gender(),cell:l=>{var u,S;return e(p,{order:l.row.original,children:((u=l.row.original.patient)==null?void 0:u.gender)&&t.messages.gender({gender:(S=l.row.original.patient)==null?void 0:S.gender})})},maxSize:50})},{type:"custom",getColumnDef:d=>d.display({id:"approver",header:t.resources.order.approver.short(),cell:l=>{var S;const u=l.row.original.requests?(S=l.row.original.requests[0].finalApprover)==null?void 0:S.fullname:"";return e(p,{order:l.row.original,children:e("div",{title:u??"",children:u})})},maxSize:120})},{type:"custom",getColumnDef:d=>d.display({id:"expectedReporter",header:t.resources.order.expectedReporter.short(),cell:l=>{var S;const u=l.row.original.requests?(S=l.row.original.requests[0].expectedReporter)==null?void 0:S.fullname:"";return e(p,{order:l.row.original,children:e("div",{title:u??"",children:u})})},maxSize:120})},{type:"custom",getColumnDef:d=>d.display({id:"operators",header:t.resources.user.type({type:zt.TECHNICIAN}),cell:l=>{var S,te,oe;const u=l.row.original.requests&&((S=l.row.original.requests[0])!=null&&S.operators)?(oe=(te=l.row.original.requests[0])==null?void 0:te.operators)==null?void 0:oe.map(Ae=>Ae.fullname).join(","):"";return e(p,{order:l.row.original,children:e("div",{title:u,children:u})})},maxSize:150})},{type:"custom",getColumnDef:d=>d.display({id:"requestedDepartment",header:t.resources.order.requestedDepartment.long(),cell:l=>{var u;return e(p,{order:l.row.original,children:((u=l.row.original.requestedDepartment)==null?void 0:u.name)??"-"})}})}]},[t.messages,t.resources.order,t.resources.study]);return g(y,{children:[e(ee,{tableId:T,tableContainerRef:s,data:a==null?void 0:a.list,tableColumnsDescription:M,FilterComponent:n,MyDataGridProps:{isLoading:b,selectRowOnRightClick:!1,hasRowClick:!0,onRowClick:(p,d,l)=>{r(Gt(d.original.id))},onRowRightClick:(p,d)=>{h(p,d.original)},onRowDoubleClick:(p,d)=>{f(d.original)}},paginationControls:{totalRecords:a==null?void 0:a.meta.totalRecords,pageSize:a==null?void 0:a.list.length},TanstackTableOptions:{enableRowSelection:!0,enableMultiRowSelection:!1},renderActionButtons:()=>e(yn,{refetch:C})}),e(un,{menuID:T})]})},Rn=o=>g(Tn,{children:[e(Dn,{children:o.CloseButton}),o.children]}),Tn=D("div")`
  position: relative;
  width: 100%;
  height: 100%;
`,Dn=D("div")`
  position: absolute;
  z-index: ${o=>o.theme.zIndex.tooltip};
  right: 0;
  top: 0;
`,wn=o=>{const{tabsList:n,currentTabkey:t,handleChange:r}=o;return g(kn,{children:[e(Ht,{value:t,onChange:r,children:n.map(s=>e(qe,{value:s.tabKey,label:s.Label},s.tabKey))}),n.map(s=>e(Uo,{value:t,tabValue:s.tabKey,children:s.TabPanel},s.tabKey))]})},kn=D("div")`
  width: 100%;
  height: 100%;
  max-height: 100%;
  display: grid;
  grid-template-rows: auto minmax(50%, 1fr);
`,Ee=o=>["US","ES","ED","ECG","SC","BMD","BDUS"].some(t=>t===o),Le=I.forwardRef((o,n)=>{const{closeModal:t,isOpen:r,orderID:s,isReadOnlyModal:i=!1}=o,c=m(),a=R(Kt(Xt)),{handleUploadFile:b,isLoading:C}=Wt(s),{handleDeleteFiles:h,isLoading:f}=$t(s),{inputRef:M,handleClickUpload:p}=Yt();return e(F,{disableEnforceFocus:!0,open:!!r,children:e($,{ref:n,closeLabel:c.buttons.close(),handleClose:t,isLoading:C||f,BoxBodyProps:{width:"100%",height:"100%"},ConfirmButton:e(y,{children:!i&&g(y,{children:[e(jt,{variant:"contained",onClick:p,children:c.resources.report.attachment.upload()}),e("input",{hidden:!0,multiple:!0,type:"file",onChange:b,ref:M})]})}),BodyComponent:e(x,{children:e(Jt,{orderID:s})}),deleteLabel:Fe.isEmpty(a)?"":c.buttons.delete(),handleDelete:i?void 0:h,handleConfirm:()=>{},title:c.resources.report.attachment.title(),width:"65%"})})});Le.displayName="AttachmentModal";const vn=()=>{const o=m(),{isOpen:n,open:t,close:r}=B(!1),s=v();return E(O.ATTACHMENT.key,()=>{t()},{disabled:!s}),g(y,{children:[e(N,{title:o.buttons.labelWithKeyBind({buttonName:o.buttons.attachment(),key:O.ATTACHMENT.title}),onClick:t,color:"inherit",children:e(Zt,{})}),e(Le,{closeModal:r,isOpen:n,orderID:s})]})},Pe=o=>e(_e,{color:"inherit",...o,children:e("path",{d:"M21.75 4.8H18V2.4C18 1.075 16.9922 0 15.75 0H8.25C7.00781 0 6 1.075 6 2.4V4.8H2.25C1.00781 4.8 0 5.875 0 7.2V21.6C0 22.925 1.00781 24 2.25 24H21.75C22.9922 24 24 22.925 24 21.6V7.2C24 5.875 22.9922 4.8 21.75 4.8ZM9 3.2H15V4.8H9V3.2ZM16.5 15.6C16.5 15.82 16.3313 16 16.125 16H13.5V18.8C13.5 19.02 13.3313 19.2 13.125 19.2H10.875C10.6687 19.2 10.5 19.02 10.5 18.8V16H7.875C7.66875 16 7.5 15.82 7.5 15.6V13.2C7.5 12.98 7.66875 12.8 7.875 12.8H10.5V10C10.5 9.78 10.6687 9.6 10.875 9.6H13.125C13.3313 9.6 13.5 9.78 13.5 10V12.8H16.125C16.3313 12.8 16.5 12.98 16.5 13.2V15.6Z"})});Pe.displayName="ItechMedicalServices";const En=({orderModalityType:o})=>{const{data:n}=eo({filter:{name:o??void 0}},{skip:!o}),t=n==null?void 0:n.list[0];return{haveOperators:Y(t==null?void 0:t.attributes,j.REQUIRES_TECHNICIAN),haveTranscribers:Y(t==null?void 0:t.attributes,j.REQUIRES_TRANSCRIBER),requireConsumable:Y(t==null?void 0:t.attributes,j.REQUIRE_CONSUMABLE)}},Ln=({orderID:o})=>{const{data:n}=P({id:o}),{isRequireConsumable:t}=to(),r=Oe(),{requireConsumable:s}=En({orderModalityType:n==null?void 0:n.modalityType});return{requireConsumable:t&&s,openModalRequireConsumableInfomation:async()=>{r.openModalMedicalEquipment&&r.openModalMedicalEquipment(!0)}}},Pn=oo.injectEndpoints({endpoints:o=>({getListConsumable:o.query({query:n=>no(n,k.CONSUMABLE),providesTags:(n={list:[],meta:{totalRecords:0}})=>[{type:k.CONSUMABLE,id:"LIST"},...n.list.map(t=>({type:k.CONSUMABLE,id:t.id}))],transformResponse:ro}),createConsumable:o.mutation({query:n=>({url:`/${k.CONSUMABLE}`,method:"POST",data:n,useAsync:!0,useHospitalID:!0}),invalidatesTags:(n,t)=>t?[]:[{type:k.CONSUMABLE,id:"LIST"}]}),updateConsumable:o.mutation({query:n=>({url:`/${k.CONSUMABLE}`,method:"PUT",data:n,useAsync:!0,useHospitalID:!0}),invalidatesTags:(n,t)=>t?[]:[{type:k.CONSUMABLE,id:"LIST"}]}),deleteConsumable:o.mutation({query:({id:n})=>({url:`/${k.CONSUMABLE}/${n}`,method:"DELETE",useAsync:!0,useHospitalID:!0}),invalidatesTags:(n,t)=>t?[]:[{type:k.CONSUMABLE,id:"LIST"}]})})}),{useGetListConsumableQuery:Be,useLazyGetListConsumableQuery:tr,useCreateConsumableMutation:or,useUpdateConsumableMutation:nr,useDeleteConsumableMutation:rr}=Pn,Bn=({request:o})=>{var t,r;const n=m();return g(An,{children:[e(Re,{Label:e(H,{title:n.resources.procedure.title(),children:n.resources.procedure.title()}),FieldValue:e(H,{title:((t=o==null?void 0:o.procedure)==null?void 0:t.name)??"",children:(r=o==null?void 0:o.procedure)==null?void 0:r.name}),valueXS:10}),e("div",{})]})},An=D("div")`
  display: grid;
  height: 100%;
  width: 100%;
  grid-template-rows: 0.5fr 2fr;
  gap: ${o=>o.theme.spacing(1)};
`,Nn=({disclosure:o,request:n})=>{const t=m();return e(F,{open:o.isOpen,children:e($,{BodyComponent:n&&e(Bn,{request:n}),title:t.messages.titles.editResource({resource:t.resources.consumable.title()}),handleClose:o.close,ConfirmButton:e(y,{}),handleConfirm:()=>{},width:"700px"})})},xn=({refetch:o})=>{const n=m(),t=B(),r=v(),s=R(K(r)),{data:i}=Te({orderID:r,requestID:s});return g(y,{children:[e(Se,{ActionsButton:g(y,{children:[e(Me,{refetch:o}),e(N,{title:n.buttons.update(),onClick:t.open,children:e(Q,{IconComponent:so,IconComponentProps:{color:"inherit"}})})]})}),e(Nn,{disclosure:t,request:i})]})},Un=({orderID:o,requestID:n})=>{const t=m(),{data:r,isLoading:s,refetch:i}=Be({filter:{requestID:n}}),c=(r==null?void 0:r.list)??[],a=I.useMemo(()=>[{type:"custom",getColumnDef:b=>b.display({id:"material.name",header:t.resources.consumable.materialName(),cell:C=>{var h;return g(y,{children:[" ",(h=C.row.original.material)==null?void 0:h.name]})},maxSize:100})},{type:"record",name:"quantity",headerLabel:t.resources.consumable.quantity(),columnDefOptions:{maxSize:100}}],[t]);return e(ee,{tableId:io,data:c,tableColumnsDescription:a,MyDataGridProps:{isLoading:s},TanstackTableOptions:{enableRowSelection:!0,enableMultiRowSelection:!1},hiddenFooter:!0,renderActionButtons:()=>e(xn,{refetch:i})})},qn=()=>{var s,i;const o=m(),n=v(),t=R(K(n)),{data:r}=Te({orderID:n,requestID:t});return g(Fn,{children:[e(Re,{Label:e(H,{title:o.resources.procedure.title(),children:o.resources.procedure.title()}),valueXS:10,FieldValue:e(H,{title:((s=r==null?void 0:r.procedure)==null?void 0:s.name)??"",children:(i=r==null?void 0:r.procedure)==null?void 0:i.name})}),e("div",{children:e(Un,{requestID:t,orderID:n})})]})},Fn=D("div")`
  display: grid;
  height: 100%;
  width: 100%;
  grid-template-rows: 0.5fr minmax(2fr, 400px);
  gap: ${o=>o.theme.spacing(1)};
`,_n=()=>{const o=ao(),n=m(),t=B(),r=v(),s=R(K(r)),{data:i}=Be({filter:{requestID:s}},{skip:!t.isOpen}),{onClick:c}=lo(),[a,b]=I.useState(!1),C=I.useMemo(()=>(i==null?void 0:i.list.length)!==0,[i==null?void 0:i.list.length]),h=a?!C:!0;return o("openModalMedicalEquipment",M=>{b(M??!1),t.open()}),t.isOpen?e(F,{open:t.isOpen,children:e($,{BodyComponent:e(qn,{}),title:n.resources.consumable.title(),handleClose:t.close,handleConfirm:M=>{t.close(),c(M)},ConfirmButton:h&&e(y,{}),confirmLabel:n.buttons.approve(),width:"700px"})}):e(y,{})},Vn=()=>{const o=v(),n=Oe(),{requireConsumable:t}=Ln({orderID:o});return e(y,{children:t&&g(y,{children:[e(N,{title:"Vật tư tiêu hao",color:"inherit",children:e(Pe,{onClick:()=>n.openModalMedicalEquipment&&n.openModalMedicalEquipment()})}),e(_n,{})]})})},zn=o=>{const n=m();return e(N,{title:n.buttons.labelWithKeyBind({buttonName:n.buttons.takePicture(),key:O.TAKE_IMAGE_DICOM.title}),color:"inherit",...o,children:e(co,{color:"inherit"})})},Gn=()=>{const o=v(),n=A(),{data:t}=P({id:o}),r=Ee((t==null?void 0:t.modalityType)??"");return t&&r?e(zn,{color:"primary",onClick:()=>{n(De({orderID:o,tabKey:X.IMAGE_UPLOAD}))}}):e(y,{})},Qn=()=>{const o=v(),{data:n}=P({id:o});return e(Hn,{children:g(ko,{children:[e(vo,{}),g(Eo,{children:[g(U,{direction:"row",children:[e(Lo,{}),e(fe,{color:"primary"}),e(Gn,{}),e(vn,{})]}),g(U,{direction:"row",children:[e(Po,{order:n,renderButton:t=>e(N,{color:"inherit",...t,children:e(uo,{color:t.disabled?"disabled":"inherit"})})}),e(Bo,{}),e(Vn,{}),e(Ao,{})]})]})]})})},Hn=o=>e(U,{direction:"row",spacing:1,alignItems:"center",children:o.children}),Kn=()=>{const o=v(),n=m(),{data:t}=P({id:o}),r=A(),s=R(po(o)),i=(h,f)=>{r(De({orderID:o,tabKey:f}))},c=h=>{o&&r(pe({orderID:o,requestID:h.id}))},a=Ee((t==null?void 0:t.modalityType)??""),C=[{tabKey:X.REPORT,Label:n.tab.quickRadiologyReport.quickReport().toUpperCase(),TabPanel:e(No,{ReportHeader:e(ke,{ActionButtons:e(Qn,{})}),ReportContent:e(ve,{isQuickReportTab:!0,onRequestChange:c})})},a&&{tabKey:X.IMAGE_UPLOAD,Label:n.buttons.takePicture().toUpperCase(),TabPanel:e(mo,{})}].filter(h=>!!h);return e(wn,{currentTabkey:s,handleChange:i,tabsList:C})},Wn=o=>{const{orderID:n,disclosure:t,reportID:r}=o,{deletable:s,deleteLockOrder:i}=ge(n),c=()=>{s&&i(),t.close()},a=(b,C)=>{C.reportStatus==="APPROVED"&&t.close()};return e(F,{open:t.isOpen,disableEnforceFocus:!0,children:e($n,{renderBody:()=>e(we,{orderID:n,reportID:r,callbacks:{onReportApproved:a,onClose:t.close},ReportComponent:e(Rn,{CloseButton:e(bo,{onClick:c,children:e(Ve,{})}),children:e(Kn,{})})})})})},$n=D(ho)`
  width: 65vw;
  max-width: 65vw;
  height: 95vh;
  max-height: 95vh;
`,Yn=()=>{const[o,n]=I.useState(),[t,r]=I.useState(),s=B(),i=ue(),c=Co(),a=I.useCallback(async(b,C)=>{await c(b)&&(n(b),r(C),s.open())},[s,c]);return i("openQuickReportModal",a),o?e(Wn,{orderID:o,disclosure:s,reportID:t},o):e(y,{})},sr=()=>{const o=m();return e(go,{title:o.pages.orderList.title(),children:g(Io,{children:[e(Jo,{}),g(yo,{children:[e(Vo,{TableComponent:e(On,{FilterComponent:e(So,{tableID:T})}),PanelComponent:e($o,{})}),e(Fo,{})]}),e(Yn,{}),e(fo,{}),e(Mo,{}),e(Oo,{}),e(Ro,{}),e(_o,{})]})})};export{sr as OrderListPage};
