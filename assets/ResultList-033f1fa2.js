import{a as r,s as I,S as M,r as R,j as T,ao as w,aF as z,aG as n,F as E,bd as B}from"./vendor-1c7a9a47.js";import{b6 as G,b7 as v,b8 as W,b9 as F,bD as N,gx as y,gy as k,gz as U,be as V,eb as _,gA as q,cz as j,dl as K,bm as O,bj as C,ex as x,gi as Q,dm as L,gB as $,bf as H,gC as Y,eT as b,gD as J,gE as X,f3 as Z,f4 as ee,f5 as re,bv as te,gF as ae,cl as oe,bU as se,cn as ie,gs as ne,cr as le,bP as de,cs as ue,c2 as ce,ca as pe,cu as me,cy as ge,cw as P,cx as A,cb as fe,cB as he,gG as ye,d7 as Se}from"./index-cdd5c634.js";import{g as be}from"./getFinalApprovedRequest-f67c0104.js";const De=a=>{const{order:i}=a,e=G(v.PUBLICATION,i);return r(W,{page:v.PUBLICATION,sidepanels:e})},Te=()=>{const a=F(N(y));return r(De,{order:a},a==null?void 0:a.id)},Fe=({children:a,title:i})=>r(we,{Head:r(U,{customTitle:i}),children:a}),we=I(k)`
  display: flex;
  max-width: 100vw;
  width: 100%;
  height: 100%;
  max-height: 100%;
  flex-direction: row;
  overflow: hidden;
`,Re=a=>{const{TableComponent:i}=a;return r(Ce,{children:r(V,{children:r(M,{height:"100%",overflow:"hidden",spacing:2,children:i})})})},Ce=I("div")`
  display: flex;
  width: 100%;
  height: 100%;
  max-height: 100%;
  overflow: hidden;
  /* padding: ${a=>a.theme.spacing(1)}; */
  padding-bottom: 0;
`,xe=a=>{const[i,{data:e}]=_(),[c,{data:p}]=q();return R.useEffect(()=>{i({filter:{types:[j.REFER_DOCTOR]}},!0),c({filter:{}},!0)},[]),e&&p?r(Ie,{formControlProps:a.formControlProps,doctors:e.list,modalityTypes:p.list}):r(K,{})},Ie=a=>{const{doctors:i,formControlProps:e,modalityTypes:c}=a,p=F(O(y)),{control:l,setValue:s,watch:f,onKeyDown:S}=e,m=C();return T(Oe,{children:[r(x,{name:"pidSuffix",control:l,MyTextFieldProps:{label:m.resources.order.patient.pid.long(),placeholder:m.resources.order.patient.pid.long(),fullWidth:!0,onKeyDown:S}}),r(x,{name:"patientName",control:l,MyTextFieldProps:{label:m.resources.order.patient.fullname.long(),placeholder:m.resources.order.patient.fullname.long(),fullWidth:!0,onKeyDown:S}}),r(x,{name:"accessionNumber",control:l,MyTextFieldProps:{label:m.resources.order.accessionNumber.long(),placeholder:m.resources.order.accessionNumber.long(),fullWidth:!0,onKeyDown:S}}),r(Q,{nameStart:"requestedDateFrom",nameEnd:"requestedDateTo",label:m.resources.order.requestedDate.long(),formSetValue:s,watch:f}),T(L,{name:"referringPhysicianID",control:l,MySelectProps:{label:m.resources.order.referringPhysician.long()},children:[r(w,{value:"",children:" "},"null"),i.map(h=>r(w,{value:h.id||"",children:h.fullname},h.id))]}),r($,{reportStatusFromQuery:p==null?void 0:p.filter.reportStatus,name:"reportStatusTemp",control:l}),T(L,{name:"modalityType",control:l,MySelectProps:{label:m.resources.order.deviceType.long()},children:[r(w,{value:"",children:" "},"null"),c.map(h=>r(w,{value:h.name||"",children:h.name},h.id))]})]})},Oe=I("div")`
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: ${a=>a.theme.spacing(3)};
`,g={accessionNumber:"",referringPhysicianID:0,id:"",patientName:"",pid:"",pidSuffix:"",reportStatus:void 0,requestedDateFrom:void 0,requestedDateTo:void 0,requestedDepartmentID:0},ve=()=>{const a=C(),i=H(),e=F(O(y)),[c]=Y(),p={mode:"onChange",resolver:z(n.object({accessionNumber:n.string().optional().transform(b),referringPhysicianID:n.preprocess(s=>s||void 0,n.number().optional()),requestedDepartmentID:n.preprocess(s=>s||void 0,n.number().optional()),id:n.string().optional(),patientName:n.string().optional().transform(b),pid:n.string().optional().transform(b),pidSuffix:n.string().optional().transform(b),reportStatusTemp:n.array(n.object({id:n.string(),status:n.union([n.string(),n.nativeEnum(J)])})).optional(),requestedDateFrom:n.string().optional().transform(b),requestedDateTo:n.string().optional().transform(b),modalityType:n.string().optional().transform(b)}).transform(s=>{var f;return{...s,ids:s.id?[parseInt(s.id)]:void 0,reportStatus:s.reportStatusTemp&&s.reportStatusTemp?s.reportStatusTemp.map(S=>S.status):void 0,id:void 0,modalityIDs:(f=e==null?void 0:e.filter)==null?void 0:f.modalityIDs,reportStatusTemp:void 0}})),defaultValues:{accessionNumber:(e==null?void 0:e.filter.accessionNumber)??g.accessionNumber,approverID:(e==null?void 0:e.filter.approverID)??g.approverID,id:g.id,patientName:(e==null?void 0:e.filter.patientName)??g.patientName,pid:(e==null?void 0:e.filter.pid)??g.pid,pidSuffix:(e==null?void 0:e.filter.pidSuffix)??g.pidSuffix,reportStatus:(e==null?void 0:e.filter.reportStatus)??g.reportStatus,requestedDateFrom:(e==null?void 0:e.filter.requestedDateFrom)??g.requestedDateFrom,requestedDateTo:(e==null?void 0:e.filter.requestedDateTo)??g.requestedDateTo,requestedDepartmentID:(e==null?void 0:e.filter.requestedDepartmentID)??g.requestedDepartmentID,reportStatusTemp:X(e==null?void 0:e.filter.reportStatus)}};return r(Z,{formOptions:p,onSubmit:s=>{i(te({tableId:y,filter:s})),e&&c({...e,filter:s})},autoSubmit:!0,submitOnEnter:!0,renderInputs:s=>r(ee,{tableID:y,handleSubmit:s.submit,renderPrimaryField:f=>r(re,{name:"patientName",control:s.control,handleSubmit:s.submit,handleExpand:f.open,isExpanded:f.isOpen,isFormDirty:s.formState.isDirty,resetFormOnDirty:!1,handleReset:()=>s.reset(g),MyTextFieldProps:{placeholder:a.resources.order.patient.fullname.long(),fullWidth:!0,onKeyDown:s.onKeyDown}}),ExtraFieldsComponent:r(xe,{formControlProps:s})})})},Le=a=>{if(!a)return[];const i=ae(e=>e.reportStatus==="APPROVED",a);return[...i[0],...i[1]]},Ee=a=>{const{refetch:i}=a,e=F(N(y)),{onClick:c}=oe({order:e});return se(de.VIEW_IMAGE.key,()=>{c()},{disabled:!e}),r(ie,{ActionsButton:T(E,{children:[r(ne,{order:e}),i&&r(le,{refetch:i,enableKeybind:!0})]})})},{StyledOrderTableRow:Ne}=he,Pe=60*1e3,Ae=a=>{var e,c;const i=(e=a.find(p=>!!p.finalApprovedTime))==null?void 0:e.finalApprovedTime;return i?(c=P(i))==null?void 0:c.format(A.dateTimeNoSecond):"-"},Me=a=>{const{FilterComponent:i}=a,e=C(),c=F(O(y)),p=R.useRef(null),{data:l,isFetching:s,refetch:f}=ue(c||B.skipToken,{pollingInterval:Pe}),{open:S}=ce(),m=R.useMemo(()=>Le(l==null?void 0:l.list),[l==null?void 0:l.list]),h=R.useMemo(()=>{const d=({order:o,children:t})=>r(Ne,{$reportStatus:o.reportStatus,$urgent:o.urgent,children:t});return[{type:"custom",getColumnDef:o=>o.display({id:"stt",header:e.messages.stt(),cell:t=>r(pe,{children:r(d,{order:t.row.original,children:t.row.index+1})}),maxSize:30})},{type:"record",name:"accessionNumber",headerLabel:e.resources.order.accessionNumber.long(),renderCell:o=>r(d,{order:o.row.original,children:o.getValue()}),columnDefOptions:{maxSize:50}},{type:"custom",getColumnDef:o=>o.display({id:"patientName",header:e.resources.order.patient.fullname.long(),cell:t=>r(d,{order:t.row.original,children:r(me,{order:t.row.original})}),maxSize:100})},{type:"custom",getColumnDef:o=>o.display({id:"patientPID",header:e.resources.order.patient.pid.long(),cell:t=>{var u;return r(d,{order:t.row.original,children:(u=t.row.original.patient)==null?void 0:u.pid})},maxSize:30})},{type:"custom",getColumnDef:o=>o.display({id:"patientGender",header:e.resources.order.patient.gender(),cell:t=>{var u,D;return r(d,{order:t.row.original,children:((u=t.row.original.patient)==null?void 0:u.gender)&&e.messages.gender({gender:(D=t.row.original.patient)==null?void 0:D.gender})})},maxSize:30})},{type:"custom",getColumnDef:o=>o.display({id:"bodyParts",header:e.resources.order.bodyParts.long(),cell:t=>{var u;return r(d,{order:t.row.original,children:((u=t.row.original.study)==null?void 0:u.bodyPartExamined)||"-"})},size:50})},{type:"custom",getColumnDef:o=>o.display({id:"requests",header:e.resources.order.requests(),cell:t=>r(d,{order:t.row.original,children:r(ge,{order:t.row.original})}),size:400})},{type:"record",name:"modalityType",headerLabel:e.resources.order.deviceType.short(),renderCell:o=>r(d,{order:o.row.original,children:o.getValue()}),columnDefOptions:{maxSize:50}},{type:"record",name:"requestedTime",headerLabel:e.resources.order.requestedDate.long(),renderCell:o=>{var t;return r(d,{order:o.row.original,children:(t=P(o.getValue()))==null?void 0:t.format(A.dateTimeNoSecond)})},columnDefOptions:{maxSize:100},enableSort:!0},{type:"custom",getColumnDef:o=>o.display({id:"finalApprovedTime",header:e.resources.order.approvedDate.short(),cell:t=>r(d,{order:t.row.original,children:t.row.original.requests?Ae(t.row.original.requests):"-"}),maxSize:100})},{type:"custom",getColumnDef:o=>o.display({id:"approver",header:e.resources.order.lockedBy.long(),cell:t=>{var u,D;return r(d,{order:t.row.original,children:(t.row.original.requests&&((D=(u=be(t.row.original))==null?void 0:u.finalApprover)==null?void 0:D.fullname))??"-"})},maxSize:100})},{type:"custom",getColumnDef:o=>o.display({id:"requestedDepartment",header:e.resources.order.requestedDepartment.long(),cell:t=>{var u;return r(d,{order:t.row.original,children:((u=t.row.original.requestedDepartment)==null?void 0:u.name)??"-"})},maxSize:100})}]},[e.messages,e.resources.order]);return r(E,{children:r(fe,{tableId:y,data:m,tableContainerRef:p,tableColumnsDescription:h,FilterComponent:i,MyDataGridProps:{isLoading:s,selectRowOnRightClick:!1,hasRowClick:!0,onRowRightClick:(d,o)=>{S(d,o.original)}},paginationControls:{totalRecords:l==null?void 0:l.meta.totalRecords,pageSize:m.length},TanstackTableOptions:{enableRowSelection:!0,enableMultiRowSelection:!1},renderActionButtons:()=>r(Ee,{refetch:f})})})},We=()=>{const a=C();return r(ye,{children:r(Fe,{title:a.pages.result.title(),children:T(Se,{children:[r(Re,{TableComponent:r(Me,{FilterComponent:r(ve,{})})}),r(Te,{})]})})})};export{We as ResultList};
