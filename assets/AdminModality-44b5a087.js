import{au as oe,aF as L,aG as a,c8 as re,a as r,j as h,x as V,b as se,ao as T,Z as P,S as j,T as ae,r as v,ag as _,C as ie,F as x,bd as le}from"./vendor-1c7a9a47.js";import{bj as g,bo as W,fg as ne,e8 as Q,e9 as U,e5 as w,dm as S,cd as de,ex as b,ew as ce,e2 as ue,fh as me,ed as R,c8 as F,dn as B,e_ as N,cj as K,bc as $,fi as ye,e4 as pe,ca as C,dM as ge,b9 as O,bD as be,cR as he,fj as fe,M as H,bf as Me,e3 as Te,bm as Y,fk as D,eT as z,f3 as Fe,f4 as De,f5 as Se,bv as Ce,c2 as Ie,f6 as q,be as Le,cb as ve,f7 as Re,f9 as Ne,fa as Ae,cH as xe,fb as we}from"./index-cdd5c634.js";import{i as J}from"./validateJSON-0b706ffc.js";import{u as Oe,a as Ee}from"./modalityGroup-498fdde8.js";import{e as ke,a as Ge}from"./modalityRoom-2c3daa2a.js";import{u as Pe,a as je}from"./modalityTypeName-04becb4d.js";import{c as ze}from"./checkUpdateFields-04f48d15.js";const X=y=>{const i=g(),{data:e}=W({filter:{}}),{control:t,getValues:s,trigger:u,formState:o}=oe({mode:"onChange",resolver:L(a.object({attributesArray:a.array(a.object({name:a.string().min(1,i.messages.validation.genericRequired({resource:i.resources.modality.attributes()})),value:a.string().min(1,i.messages.validation.genericRequired({resource:i.resources.modality.attributesValue()}))}))})),defaultValues:{}}),{fields:d,...m}=re({control:t,name:"attributesArray"});return{modalityList:e==null?void 0:e.list,attributeFieldArray:{formState:o,fields:d,methods:m,control:t,getValues:s,trigger:u}}},qe=y=>{const{control:i,name:e,modalityTypeName:t}=y,{data:s}=ne({filter:{modalityTypes:t?[t]:void 0}}),u=g();return s?r(Q,{name:e,control:i,placeholder:u.resources.modality.addProcedure(),enableSelectAll:!0,MyAutoCompleteProps:{size:"small",options:s.list,isOptionEqualToValue:(o,d)=>o.id===d.id,getOptionLabel:o=>typeof o!="string"?`${o==null?void 0:o.id} - ${o==null?void 0:o.name}`:o,renderOption:(o,d,m)=>r("li",{...o,children:h(U,{children:[r(V,{size:"small",checked:m.selected}),d==null?void 0:d.id,"-",d==null?void 0:d.name]})})}}):r(se,{})},Ve=y=>{var d;const{control:i,record:e}=y,t=g(),s=(d=e==null?void 0:e.group)==null?void 0:d.name,[u]=Oe(),o=async()=>{var m;return((m=(await u({filter:{}})).data)==null?void 0:m.list)??[]};return r(w,{name:"groupID",control:i,MySelectProps:{label:t.resources.modality.group.short()},disableValue:s??"",onGetListRecord:o,renderSelectField:({listData:m,formSelectFieldProps:c})=>r(S,{...c,children:m.map(l=>r(T,{value:(l==null?void 0:l.id)||"",children:l.name},l.id))})})},_e=y=>{var d;const{control:i,record:e}=y,t=g(),s=(d=e==null?void 0:e.room)==null?void 0:d.name,[u]=ke(),o=async()=>{var m;return((m=(await u({filter:{}})).data)==null?void 0:m.list)??[]};return r(w,{name:"roomID",control:i,MySelectProps:{label:t.resources.modality.room.short()},disableValue:s??"",onGetListRecord:o,renderSelectField:({listData:m,formSelectFieldProps:c})=>r(S,{...c,children:m.map(l=>r(T,{value:(l==null?void 0:l.id)||"",children:l.name},l.id))})})},We=y=>{const{control:i,watch:e}=y,t=g(),s=e("modalityType"),[u]=Pe(),o=async()=>{var d;return((d=(await u({filter:{}})).data)==null?void 0:d.list)??[]};return r(w,{name:"modalityType",control:i,required:!0,MySelectProps:{label:t.resources.modality.modalityType.short()},disableValue:s,onGetListRecord:o,renderSelectField:({listData:d,formSelectFieldProps:m})=>r(S,{...m,children:d.map(c=>r(T,{value:(c==null?void 0:c.id)||"",children:c.id},c.id))})})},Z=y=>{const{control:i,formState:e,onKeyDown:t,record:s,watch:u}=y,o=g(),d=u("modalityType");return h(P,{display:"flex",children:[h(j,{spacing:1,alignItems:"start",width:"500px",children:[s&&r(de,{value:s.id,size:"small",label:"ID",disabled:!0,fullWidth:!0}),r(b,{name:"name",control:i,MyTextFieldProps:{label:o.resources.modality.name.short(),placeholder:o.resources.modality.name.short(),fullWidth:!0,required:!0,onKeyDown:t}}),r(We,{control:i,watch:u}),r(Ve,{control:i,record:s}),r(b,{name:"ipAddress",control:i,MyTextFieldProps:{label:o.resources.modality.ipAddress(),placeholder:o.resources.modality.ipAddress(),fullWidth:!0,onKeyDown:t}}),r(b,{name:"institutionName",control:i,MyTextFieldProps:{label:o.resources.modality.institutionName(),placeholder:o.resources.modality.institutionName(),fullWidth:!0,onKeyDown:t}}),r(b,{name:"capability",control:i,MyTextFieldProps:{label:o.resources.modality.capability(),placeholder:o.resources.modality.capability(),fullWidth:!0,size:"small",type:"number",onKeyDown:t}}),s&&r(ce,{control:i,render:({value:m,onChange:c})=>h(P,{sx:{display:"flex",alignItems:"center"},children:[r(ue,{checked:!!m,onChange:c}),r(ae,{children:o.resources.modality.enabled()})]}),name:"enabled"})]}),h(j,{width:"500px",spacing:1,ml:4,children:[r(b,{name:"code",control:i,MyTextFieldProps:{label:o.resources.modality.code.short(),placeholder:o.resources.modality.code.short(),fullWidth:!0,required:!0,onKeyDown:t}}),r(_e,{control:i,record:s}),r(b,{name:"aeTitle",control:i,MyTextFieldProps:{label:o.resources.modality.aeTitle(),placeholder:o.resources.modality.aeTitle(),fullWidth:!0,onKeyDown:t}}),r(b,{name:"manufacturerModelName",control:i,MyTextFieldProps:{label:o.resources.modality.manufacturerModelName(),placeholder:o.resources.modality.manufacturerModelName(),fullWidth:!0,onKeyDown:t}}),r(b,{name:"stationName",control:i,MyTextFieldProps:{label:o.resources.modality.stationName(),placeholder:o.resources.modality.stationName(),fullWidth:!0,onKeyDown:t}}),r(qe,{modalityTypeName:d,control:i,name:"procedures"}),r(b,{name:"config",control:i,MyTextFieldProps:{label:o.resources.modality.config(),placeholder:o.resources.modality.config(),fullWidth:!0,size:"small",multiline:!0,minRows:3}})]})]})},I=3,Qe=y=>{const{onSuccessCallback:i}=y,[e]=me(),t=g(),s=R(),{modalityList:u}=X(),o={mode:"onChange",criteriaMode:"all",resolver:L(a.object({code:a.string().trim().min(1,t.messages.validation.genericRequired({resource:t.resources.modality.code.short()})).refine(l=>!(u&&u.some(n=>n.code===l)),{message:t.messages.validation.genericDuplicated({name:t.resources.modality.code.short()})}),name:a.string().trim().min(I,t.messages.validation.genericMinLength({resource:t.resources.modality.name.short(),length:I})),groupID:a.number({required_error:t.messages.validation.genericRequired({resource:t.resources.modality.group.short()})}),modalityType:a.string({required_error:t.messages.validation.genericRequired({resource:t.resources.modality.modalityType.short()})}),roomID:a.number({required_error:t.messages.validation.genericRequired({resource:t.resources.modality.room.short()})}),aeTitle:a.string().optional(),ipAddress:a.string().optional(),institutionName:a.string().optional(),stationName:a.string().optional(),enabled:a.boolean().optional(),procedures:a.array(a.object({id:a.number()})).optional(),otherModalityList:a.array(a.object({modalityAbbr:a.string()})).optional(),manufacturerModelName:a.string().optional(),config:a.string().refine(l=>l.length?J(l):!0,t.messages.validation.genericRequiredType({resource:t.resources.certificate.config(),type:"jsonObject"})).optional(),capability:a.union([a.string(),a.number()]).transform(l=>parseInt(l)).optional()}).transform(l=>{var n;return{...l,procedureIDs:(n=l.procedures)==null?void 0:n.map(p=>p.id),procedures:void 0}})),defaultValues:{name:"",code:"",groupID:void 0,roomID:void 0,modalityType:void 0,aeTitle:"",ipAddress:"",institutionName:"",stationName:"",enabled:!0,procedures:[],procedureIDs:[],manufacturerModelName:"",capability:void 0,config:""}},d=F("success",t.messages.titles.createResource({resource:t.resources.modality.title().toLowerCase()})),m=F("error",t.messages.titles.createResource({resource:t.resources.modality.title().toLowerCase()}));return r(B,{registerFormFunctions:l=>s("submitCreateForm",()=>l.submit&&l.submit()),onSubmit:async l=>{try{"error"in await e(l)?m():(d(),i())}catch{m()}},submitOnEnter:!0,formOptions:o,renderInputs:l=>r(Z,{...l})})},Ue=()=>{const{isOpen:y,open:i,close:e}=$(!1);return R()("openCreateModal",i),r(_,{open:y,children:r(ee,{closeModal:e})})},ee=v.forwardRef((y,i)=>{const{closeModal:e}=y,t=g(),s=N();return r(K,{ref:i,confirmLabel:t.buttons.create(),handleClose:e,BodyComponent:r(Qe,{onSuccessCallback:e}),handleConfirm:()=>s.submitCreateForm(),title:t.messages.titles.createResource({resource:t.resources.modality.title().toLowerCase()})})});ee.displayName="ModalityCreateModal";const Be=y=>{const{onSuccessCallback:i,record:e}=y,[t]=ye(),s=g(),u=R(),{modalityList:o}=X(),d={mode:"onChange",criteriaMode:"all",resolver:L(a.object({code:a.string().trim().min(1,s.messages.validation.genericRequired({resource:s.resources.modality.code.short()})).refine(n=>n===e.code?!0:!(o&&o.some(p=>p.code===n)),{message:s.messages.validation.genericDuplicated({name:s.resources.modality.code.short()})}),name:a.string().trim().min(I,s.messages.validation.genericMinLength({resource:s.resources.modality.name.short(),length:I})),groupID:a.number({required_error:s.messages.validation.genericRequired({resource:s.resources.modality.group.short()})}),modalityType:a.string({required_error:s.messages.validation.genericRequired({resource:s.resources.modality.modalityType.long()})}),roomID:a.number({required_error:s.messages.validation.genericRequired({resource:s.resources.modality.room.short()})}),aeTitle:a.string().optional(),ipAddress:a.string().optional(),institutionName:a.string().optional(),stationName:a.string().optional(),enabled:a.boolean().optional(),procedures:a.array(a.object({id:a.number()})).optional(),otherModalityList:a.array(a.object({modalityAbbr:a.string()})).optional(),manufacturerModelName:a.string().optional(),config:a.string().refine(n=>n.length?J(n):!0,s.messages.validation.genericRequiredType({resource:s.resources.certificate.config(),type:"jsonObject"})).optional(),capability:a.union([a.string(),a.number()]).transform(n=>{const p=parseInt(n);return isNaN(p)?0:p}).optional()}).transform(n=>{var p;return{...n,procedureIDs:(p=n.procedures)==null?void 0:p.map(f=>f.id),procedures:void 0}})),defaultValues:{id:e.id,name:e.name??"",code:e.code??"",groupID:e.group?e.group.id:void 0,roomID:e.room?e.room.id:void 0,modalityType:(e==null?void 0:e.modalityType)??void 0,aeTitle:e.aeTitle??"",ipAddress:e.ipAddress??"",institutionName:(e==null?void 0:e.institutionName)??"",stationName:e.stationName??"",enabled:(e==null?void 0:e.enabled)??!1,procedures:e.procedures??void 0,procedureIDs:[],manufacturerModelName:(e==null?void 0:e.manufacturerModelName)??"",capability:(e==null?void 0:e.capability)??void 0}},m=F("success",s.messages.titles.editResource({resource:s.resources.modality.title().toLowerCase()})),c=F("error",s.messages.titles.editResource({resource:s.resources.modality.title().toLowerCase()}));return r(B,{registerFormFunctions:n=>u("submitEditForm",()=>n.submit&&n.submit()),onSubmit:async n=>{var E,k,G;const p={...e,roomID:(E=e==null?void 0:e.room)==null?void 0:E.id,groupID:(k=e==null?void 0:e.group)==null?void 0:k.id,procedureIDs:(G=e==null?void 0:e.procedures)==null?void 0:G.map(A=>A.id)},{updateData:f,canUpdate:M}=ze(Object.keys(n),p,n);if(M)try{"error"in await t({...f,id:e.id})?c():(m(),i())}catch{c()}},submitOnEnter:!0,formOptions:d,renderInputs:n=>r(Z,{...n,record:e})})},Ke=()=>{const{isOpen:y,open:i,close:e}=$(!1),t=g(),s=ge(),u=O(be(he.MODALITY)),[o]=fe(),d=R();d("openEditModal",i);const m=F("success",t.messages.titles.deleteResource({resource:t.resources.certificate.title().toLowerCase()})),c=F("error",t.messages.titles.deleteResource({resource:t.resources.certificate.title().toLowerCase()})),l=v.useCallback(()=>{u&&s({message:`${t.messages.notification.delete({name:`${u.name}`})}`,options:{variant:"warning",onConfirm:()=>{"error"in o({id:u.id})?c():(m(),e())}}})},[e,o,c,s,m,u,t.messages.notification]);return d("submitDelete",()=>l()),u?r(_,{open:y,children:r(te,{record:u,closeModal:e})}):r(x,{})},te=v.forwardRef((y,i)=>{const{closeModal:e,record:t}=y,s=g(),u=N(),{data:o}=pe({id:t.id});return r(K,{ref:i,confirmLabel:s.buttons.update(),handleConfirm:()=>u.submitEditForm(),handleClose:e,BodyComponent:o?r(Be,{record:o,onSuccessCallback:e},o.id):r(C,{children:r(ie,{})}),title:s.messages.titles.editResource({resource:s.resources.modality.title().toLowerCase()})})});te.displayName="ModalityEditModal";const $e=y=>{const{formControlProps:i}=y,e=g(),{data:t}=je({filter:{}}),{data:s}=Ge({filter:{}}),{data:u}=Ee({filter:{}}),o=t==null?void 0:t.list,d=s==null?void 0:s.list,m=u==null?void 0:u.list;return h(x,{children:[r(b,{name:"code",control:i.control,MyTextFieldProps:{label:e.resources.modality.code.long(),placeholder:e.resources.modality.code.long(),fullWidth:!0,onKeyDown:i.onKeyDown}}),o&&r(Q,{name:"modalityTypeData",control:i.control,placeholder:e.resources.modality.modalityType.long(),enableSelectAll:!0,MyAutoCompleteProps:{size:"small",disablePortal:!0,options:o,isOptionEqualToValue:(c,l)=>c.id===l.id,getOptionLabel:c=>c==null?void 0:c.id,renderOption:(c,l,n)=>r("li",{...c,children:h(U,{children:[r(V,{size:"small",checked:n.selected}),l==null?void 0:l.id]})})}},H()),h(S,{name:"roomIdString",control:i.control,MySelectProps:{label:e.resources.modality.room.long(),placeholder:e.resources.modality.room.long()},children:[r(T,{value:"",children:" "},"null"),d&&d.map(c=>r(T,{value:c.id.toString()||"",children:c.code},c.id))]}),h(S,{name:"groupIdString",control:i.control,MySelectProps:{label:e.resources.modality.group.long(),placeholder:e.resources.modality.group.long()},children:[r(T,{value:"",children:" "},"null"),m&&m.map(c=>r(T,{value:c.id.toString()||"",children:c.code},c.id))]})]})},He={name:"",code:"",groupID:void 0,modalityTypeData:void 0,roomID:void 0},Ye=()=>{const y=g(),i=Me(),[e]=Te(),t=O(Y(D)),s={mode:"onChange",resolver:L(a.object({name:a.string().trim().optional().transform(z),code:a.string().trim().optional().transform(z),groupIdString:a.string().optional(),roomIdString:a.string().optional(),roomID:a.number().optional(),groupID:a.number().optional(),modalityTypeData:a.array(a.object({id:a.string()})).optional(),modalityTypes:a.array(a.string()).optional()}).transform(o=>({...o,modalityTypes:o.modalityTypeData&&o.modalityTypeData.length?o.modalityTypeData.map(d=>d.id):void 0,modalityTypeData:void 0,roomID:o.roomIdString?parseInt(o.roomIdString):void 0,groupID:o.groupIdString?parseInt(o.groupIdString):void 0,groupIdString:void 0,roomIdString:void 0}))),defaultValues:{name:(t==null?void 0:t.filter.name)??"",code:(t==null?void 0:t.filter.code)??"",groupID:(t==null?void 0:t.filter.groupID)??void 0,modalityTypes:(t==null?void 0:t.filter.modalityTypes)??void 0,roomID:(t==null?void 0:t.filter.roomID)??void 0}};return r(Fe,{formOptions:s,onSubmit:o=>{i(Ce({tableId:D,filter:o})),t&&e({...t,filter:o})},autoSubmit:!0,submitOnEnter:!0,renderInputs:o=>r(De,{handleSubmit:o.submit,renderPrimaryField:({open:d,isOpen:m})=>r(Se,{name:"name",control:o.control,handleSubmit:o.submit,handleExpand:d,isExpanded:m,isFormDirty:o.formState.isDirty,resetFormOnDirty:!1,handleReset:()=>o.reset(He),MyTextFieldProps:{placeholder:y.resources.modality.name.long(),fullWidth:!0,onKeyDown:o.onKeyDown}}),ExtraFieldsComponent:r($e,{formControlProps:o},H())})})},Je=y=>{var l;const{FilterComponent:i}=y,e=g(),t=O(Y(D)),{data:s,isFetching:u,refetch:o}=W(t||le.skipToken),{open:d}=Ie(),m=N(),c=v.useMemo(()=>[{type:"custom",getColumnDef:n=>n.display({id:"stt",header:e.messages.stt(),cell:p=>r(C,{children:p.row.index+1}),minSize:q,maxSize:q})},{type:"record",name:"id",headerLabel:"ID",renderCell:n=>r(C,{children:n.getValue()}),columnDefOptions:{maxSize:50}},{type:"record",name:"name",headerLabel:e.resources.modality.name.short(),columnDefOptions:{size:350}},{type:"record",name:"code",headerLabel:e.resources.modality.code.short(),columnDefOptions:{size:150}},{type:"record",name:"modalityType",headerLabel:e.resources.modality.modalityType.short(),columnDefOptions:{size:150}},{type:"custom",getColumnDef:n=>n.display({id:"group",header:()=>e.resources.modality.group.short(),cell:p=>{var f,M;return((M=(f=p.row.original)==null?void 0:f.group)==null?void 0:M.description)??null},size:200})},{type:"custom",getColumnDef:n=>n.display({id:"room",header:()=>e.resources.modality.room.short(),cell:p=>{var f,M;return((M=(f=p.row.original)==null?void 0:f.room)==null?void 0:M.name)??null},size:400})},{type:"record",name:"enabled",headerLabel:e.messages.status.long(),renderCell:n=>r(C,{children:n.getValue()?e.resources.modality.enabled():e.resources.modality.disabled()}),columnDefOptions:{size:400}}],[e.messages,e.resources.modality]);return r(Le,{children:r(ve,{tableId:D,data:s==null?void 0:s.list,FilterComponent:i,tableColumnsDescription:c,MyDataGridProps:{isLoading:u,onRowRightClick:n=>{d(n)},onRowDoubleClick(){m.openEditModal()}},paginationControls:{totalRecords:s==null?void 0:s.meta.totalRecords,pageSize:(l=s==null?void 0:s.list)==null?void 0:l.length},TanstackTableOptions:{enableRowSelection:!0,enableMultiRowSelection:!1},renderActionButtons:()=>r(Re,{tableId:D,refetch:o}),sx:{height:"100%"}})})},at=()=>{const y=g(),i=N();return h(Ne,{children:[r(Ae,{title:y.resources.modality.title(),TableComponent:r(Je,{FilterComponent:r(Ye,{})}),ActionButtons:r(x,{children:r(xe,{variant:"contained",onClick:()=>i.openCreateModal(),children:y.buttons.create()})})}),r(Ue,{}),r(Ke,{}),r(we,{})]})};export{at as AdminModality};
