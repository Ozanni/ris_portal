import{aF as P,aG as m,a as e,j as g,S as W,ao as F,Z as _,T as j,y as te,r as x,F as R,C as re,ag as V,bd as se}from"./vendor-1c7a9a47.js";import{eW as ne,eX as O,bj as f,ed as A,c8 as S,dn as Q,ex as C,dm as N,e2 as q,eY as ae,eZ as G,cd as oe,e_ as v,e$ as ie,cj as H,ca as M,bc as U,b9 as L,bD as $,cR as X,f0 as le,dM as ce,bf as de,bm as B,f1 as E,f2 as me,eT as k,f3 as ue,f4 as pe,f5 as be,bv as he,c2 as fe,f6 as I,cb as Z,f7 as Y,f8 as z,e6 as ge,f9 as De,fa as ye,cH as Ce,fb as Me}from"./index-cdd5c634.js";import{c as Fe}from"./checkUpdateFields-04f48d15.js";import{C as Se}from"./CollapsiblePanel-1b32f69e.js";const w=3,Te=a=>{const{onSuccessCallback:l}=a,[t]=ne(),{data:o}=O({filter:{}}),r=o==null?void 0:o.list,s=f(),n=A(),b=S("success",s.messages.titles.createResource({resource:s.resources.department.title().toLowerCase()})),i=S("error",s.messages.titles.createResource({resource:s.resources.department.title().toLowerCase()})),p={mode:"onChange",criteriaMode:"all",resolver:P(m.object({name:m.string().trim().min(w,s.messages.validation.genericMinLength({resource:s.resources.department.name(),length:w})),code:m.string().trim().min(1,s.messages.validation.genericRequired({resource:s.resources.department.code()})).refine(c=>!(r&&r.some(h=>h.code===c)),{message:s.messages.validation.genericDuplicated({name:s.resources.department.code()})}),parentID:m.preprocess(c=>c||void 0,m.number().optional()),description:m.string().optional()})),defaultValues:{name:"",code:"",description:""}};return e(Q,{registerFormFunctions:c=>n("submitCreateForm",()=>c.submit&&c.submit()),onSubmit:async c=>{try{"error"in await t(c)?i():(b(),l())}catch{i()}},submitOnEnter:!0,formOptions:p,renderInputs:({control:c,formState:h,onKeyDown:d})=>g(W,{spacing:1,alignItems:"start",width:"500px",children:[e(C,{name:"name",control:c,MyTextFieldProps:{label:s.resources.department.name(),placeholder:s.resources.department.name(),fullWidth:!0,required:!0,onKeyDown:d,size:"extrasmall"}}),e(C,{name:"code",control:c,MyTextFieldProps:{label:s.resources.department.code(),placeholder:s.resources.department.code(),fullWidth:!0,required:!0,onKeyDown:d,size:"extrasmall"}}),g(N,{name:"parentID",control:c,MySelectProps:{label:s.resources.department.parent()},children:[e(F,{value:0,children:" "},"null"),r&&r.map(D=>e(F,{value:D.id,children:D.name},D.id))]}),e(C,{name:"description",control:c,MyTextFieldProps:{label:s.resources.department.description(),placeholder:s.resources.department.description(),fullWidth:!0,onKeyDown:d,multiline:!0,rows:2}}),g(_,{display:"flex",alignItems:"center",children:[e(q,{checked:!0}),e(j,{children:s.resources.department.enabled()})]})]})})},Ee=a=>{var h;const{onSuccessCallback:l,record:t}=a,[o]=ae(),{data:r}=O({filter:{}}),s=r==null?void 0:r.list.filter(d=>d.id!==t.id),n=f(),b=A(),i={mode:"onChange",criteriaMode:"all",resolver:P(m.object({name:m.string().trim().min(w,n.messages.validation.genericMinLength({resource:n.resources.department.name(),length:w})),code:m.string().trim().min(1,n.messages.validation.genericRequired({resource:n.resources.department.code()})).refine(d=>!(s&&s.some(D=>D.code===d)),{message:n.messages.validation.genericDuplicated({name:n.resources.department.code()})}),parentID:m.number().optional().transform(G),description:m.string().optional().transform(G),enabled:m.boolean().optional()})),defaultValues:{name:t.name??"",code:t.code??"",description:t.description??"",parentID:((h=t.parent)==null?void 0:h.id)??void 0,enabled:t.enabled??!1}},p=S("success",n.messages.titles.editResource({resource:n.resources.department.title().toLowerCase()})),u=S("error",n.messages.titles.editResource({resource:n.resources.department.title().toLowerCase()}));return e(Q,{registerFormFunctions:d=>b("submitEditForm",()=>d.submit&&d.submit()),onSubmit:async d=>{const{updateData:D,canUpdate:T}=Fe(Object.keys(d),t,d);if(T)try{"error"in await o({...D,id:t.id})?u():(p(),l())}catch{u()}},submitOnEnter:!0,formOptions:i,renderInputs:({control:d,formState:D,onKeyDown:T})=>g(W,{spacing:1,alignItems:"start",width:"500px",children:[e(oe,{value:t.id,label:"ID",size:"small",disabled:!0,fullWidth:!0}),e(C,{name:"name",control:d,MyTextFieldProps:{label:n.resources.department.name(),placeholder:n.resources.department.name(),fullWidth:!0,required:!0,onKeyDown:T}}),e(C,{name:"code",control:d,MyTextFieldProps:{label:n.resources.department.code(),placeholder:n.resources.department.code(),fullWidth:!0,required:!0,onKeyDown:T}}),g(N,{name:"parentID",control:d,MySelectProps:{label:n.resources.department.parent()},children:[e(F,{value:0,children:" "},"null"),s&&s.map(y=>e(F,{value:y.id,children:y.name},y.id))]}),e(C,{name:"description",control:d,MyTextFieldProps:{label:n.resources.department.description(),placeholder:n.resources.department.description(),fullWidth:!0,onKeyDown:T,multiline:!0,rows:2}}),g(_,{display:"flex",alignItems:"center",children:[e(te,{name:"enabled",control:d,render:({field:{value:y,onChange:ee}})=>e(q,{checked:!!y,onChange:ee})}),e(j,{children:n.resources.department.enabled()})]})]})})},xe=()=>{const{isOpen:a,open:l,close:t}=U(!1),o=L($(X.DEPARTMENT)),[r]=le(),s=f(),n=ce(),b=A();b("openEditModal",l);const i=S("success",s.messages.titles.deleteResource({resource:s.resources.department.title().toLowerCase()})),p=S("error",s.messages.titles.deleteResource({resource:s.resources.department.title().toLowerCase()})),u=x.useCallback(()=>{o&&n({message:`${s.messages.notification.delete({name:`${o==null?void 0:o.name}`})}`,options:{variant:"warning",onConfirm:()=>{"error"in r({id:o.id})?p():(i(),t())}}})},[t,r,p,n,i,o,s.messages.notification]);return b("submitDelete",()=>u()),o?e(V,{open:a,children:e(J,{record:o,closeModal:t})}):e(R,{})},J=x.forwardRef((a,l)=>{const{closeModal:t,record:o}=a,r=f(),s=v(),{data:n}=ie({id:o.id});return e(R,{children:e(H,{ref:l,confirmLabel:r.buttons.update(),handleConfirm:()=>s.submitEditForm(),handleClose:t,BodyComponent:n?e(Ee,{record:n,onSuccessCallback:t}):e(M,{children:e(re,{})}),title:r.messages.titles.editResource({resource:r.resources.department.title().toLowerCase()})})})});J.displayName="DepartmentEditModal";const Re=()=>{const{isOpen:a,open:l,close:t}=U(!1);return A()("openCreateModal",l),e(V,{open:a,children:e(K,{closeModal:t})})},K=x.forwardRef((a,l)=>{const{closeModal:t}=a,o=f(),r=v();return e(H,{ref:l,confirmLabel:o.buttons.create(),handleClose:t,BodyComponent:e(Te,{onSuccessCallback:t}),handleConfirm:()=>r.submitCreateForm(),title:o.messages.titles.createResource({resource:o.resources.department.title().toLowerCase()})})});K.displayName="DepartmentCreateModal";const Le={code:"",name:"",parentID:""},Ie=()=>{const a=f(),l=de(),t=L(B(E)),[o]=me(),{data:r}=O({filter:{}}),s=r==null?void 0:r.list,n={mode:"onChange",resolver:P(m.object({name:m.string().trim().optional().transform(k),code:m.string().trim().optional().transform(k),parentID:m.union([m.number(),m.string()]).optional().transform(k)})),defaultValues:{code:(t==null?void 0:t.filter.code)??"",name:(t==null?void 0:t.filter.name)??"",parentID:(t==null?void 0:t.filter.parentID)??""}};return e(ue,{formOptions:n,onSubmit:i=>{l(he({tableId:E,filter:i})),t&&o({...t,filter:i})},submitOnEnter:!0,autoSubmit:!0,renderInputs:i=>e(pe,{handleSubmit:i.submit,renderPrimaryField:({open:p,isOpen:u})=>e(be,{name:"name",control:i.control,handleSubmit:i.submit,handleExpand:p,isExpanded:u,isFormDirty:i.formState.isDirty,resetFormOnDirty:!1,handleReset:()=>i.reset(Le),MyTextFieldProps:{placeholder:a.resources.department.name(),fullWidth:!0,onKeyDown:i.onKeyDown}}),ExtraFieldsComponent:g(R,{children:[e(C,{name:"code",control:i.control,MyTextFieldProps:{label:a.resources.department.code(),placeholder:a.resources.department.code(),fullWidth:!0,onKeyDown:i.onKeyDown}}),g(N,{name:"parentID",control:i.control,MySelectProps:{label:a.resources.department.parent()},children:[e(F,{value:"",children:" "},"null"),s&&s.map(p=>e(F,{value:p.id,children:p.name},p.id))]})]})})})},we=a=>{const{FilterComponent:l}=a,t=f(),o=L(B(E)),{data:r,isFetching:s,refetch:n}=O(o||se.skipToken),b=v(),{open:i}=fe(),p=x.useMemo(()=>[{type:"custom",getColumnDef:u=>u.display({id:"stt",header:t.messages.stt(),cell:c=>e(M,{children:c.row.index+1}),minSize:I,maxSize:I})},{type:"record",name:"id",headerLabel:"ID",renderCell:u=>e(M,{children:u.getValue()}),columnDefOptions:{maxSize:50},enableSort:!0},{type:"record",name:"name",headerLabel:t.resources.department.name(),columnDefOptions:{size:450}},{type:"record",name:"code",headerLabel:t.resources.department.code(),columnDefOptions:{size:250}},{type:"custom",getColumnDef:u=>u.display({id:"parent",header:()=>t.resources.department.parent(),cell:c=>{var h;return(h=c.row.original.parent)==null?void 0:h.name},size:450})},{type:"record",name:"enabled",headerLabel:t.messages.status.long(),renderCell:u=>e(M,{children:u.getValue()?t.resources.department.enabled():t.resources.department.disabled()}),columnDefOptions:{size:450}}],[t.messages,t.resources.department]);return e(Z,{tableId:E,data:r==null?void 0:r.list,FilterComponent:l,tableColumnsDescription:p,MyDataGridProps:{isLoading:s,onRowRightClick:u=>{i(u)},onRowDoubleClick(){b.openEditModal()}},paginationControls:{totalRecords:r==null?void 0:r.meta.totalRecords,pageSize:r==null?void 0:r.list.length},TanstackTableOptions:{enableRowSelection:!0,enableMultiRowSelection:!1},renderActionButtons:()=>e(Y,{tableId:E,refetch:n})})},Oe=a=>{const{departmentID:l}=a,t=f(),o=L(B(z)),{data:r,isFetching:s,refetch:n}=ge({...o,filter:{departmentID:l}}),b=x.useMemo(()=>[{type:"custom",getColumnDef:i=>i.display({id:"stt",header:t.messages.stt(),cell:p=>e(M,{children:p.row.index+1}),minSize:I,maxSize:I})},{type:"record",name:"id",headerLabel:"ID",renderCell:i=>e(M,{children:i.getValue()}),columnDefOptions:{maxSize:50}},{type:"record",name:"code",headerLabel:t.resources.user.code(),columnDefOptions:{size:50}},{type:"record",name:"fullname",headerLabel:t.resources.user.fullname(),columnDefOptions:{size:50}},{type:"record",name:"title",headerLabel:t.resources.user.title(),columnDefOptions:{size:50}}],[t.messages,t.resources.user]);return e(Z,{tableId:z,data:r==null?void 0:r.list,tableColumnsDescription:b,paginationControls:{totalRecords:r==null?void 0:r.meta.totalRecords,pageSize:r==null?void 0:r.list.length},MyDataGridProps:{isLoading:s},TanstackTableOptions:{enableRowSelection:!1},renderActionButtons:()=>e(Y,{tableId:z,refetch:n,hideButtonAdd:!0,hideButtonDelete:!0,hideButtonEdit:!0})})},Ae=()=>{const a=L($(X.DEPARTMENT)),{isOpen:l,open:t,close:o}=U(!0),r=a==null?void 0:a.id,s=a==null?void 0:a.name,n=f();return r?e(Se,{initialExpanded:l,onExpand:t,onCollapse:o,onClose:o,title:n.messages.titles.departmentUserList({department:s||""}),children:e(Oe,{departmentID:r})},r):e(R,{})},Ne=()=>{const a=f(),l=v();return g(De,{children:[e(ye,{title:a.resources.department.title(),TableComponent:e(we,{FilterComponent:e(Ie,{})}),PanelComponent:e(Ae,{}),ActionButtons:e(R,{children:e(Ce,{variant:"contained",onClick:()=>l.openCreateModal(),children:a.buttons.create()})})}),e(Re,{}),e(xe,{}),e(Me,{})]})};export{Ne as AdminDepartment};
