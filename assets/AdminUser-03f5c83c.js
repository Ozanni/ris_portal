import{a as s,j as f,x as G,b as j,ao as v,r as L,s as O,T as Y,ca as de,S as U,F as x,a9 as A,Z as me,y as pe,aF as V,aG as n,ag as ee,C as ge,bd as he}from"./vendor-1c7a9a47.js";import{bo as se,bj as I,e8 as W,e9 as B,e5 as P,dm as T,f2 as ye,g0 as be,g1 as fe,g2 as Ie,cH as re,ex as C,e2 as Fe,ed as z,g3 as Me,e6 as _,c8 as w,g4 as b,dn as te,bc as ae,e_ as k,cj as ne,g5 as Se,eT as D,dM as ve,b9 as Q,bD as Ce,cR as De,g6 as Le,ec as Ue,ca as E,bf as Te,eX as we,eb as Re,bm as le,g7 as R,f3 as xe,f4 as Ee,f5 as Oe,bv as ze,c2 as ke,f6 as H,be as Ae,cb as Ge,f7 as je,f9 as Ve,fa as We,fb as Be}from"./index-cdd5c634.js";import{u as ie}from"./role-14050e4a.js";import{e as N}from"./userGroup-c97bc4e8.js";import{b as Pe}from"./certificate-ac1684c8.js";import{u as _e,a as Qe}from"./userType-feaf7698.js";const $=o=>{const{data:l}=N({filter:{}}),{data:e}=ie({filter:{}}),{data:t}=se({filter:{}});return{modalityData:t,roleData:e,userGroupData:l}},Ne=o=>{const{control:l,name:e}=o,{data:t}=se({filter:{}}),c=I();return t?s(W,{name:e,control:l,placeholder:c.resources.user.modality(),enableSelectAll:!0,MyAutoCompleteProps:{size:"small",fullWidth:!0,options:t.list,isOptionEqualToValue:(a,r)=>a.id===r.id,getOptionLabel:a=>typeof a!="string"?`${a==null?void 0:a.id} - ${a==null?void 0:a.name}`:a,renderOption:(a,r,i)=>s("li",{...a,children:f(B,{children:[s(G,{size:"small",checked:i.selected}),r==null?void 0:r.id,"-",r==null?void 0:r.name]})})}}):s(j,{})},$e=o=>{const{control:l,name:e}=o,{data:t}=ie({filter:{}}),c=I();return t?s(W,{name:e,control:l,placeholder:c.resources.user.role(),enableSelectAll:!0,MyAutoCompleteProps:{size:"small",fullWidth:!0,options:t.list,isOptionEqualToValue:(a,r)=>a.id===r.id,getOptionLabel:a=>typeof a!="string"?`${a==null?void 0:a.id} - ${a==null?void 0:a.name}`:a,renderOption:(a,r,i)=>s("li",{...a,children:f(B,{children:[s(G,{size:"small",checked:i.selected}),r==null?void 0:r.id,"-",r==null?void 0:r.name]})})}}):s(j,{})},qe=({control:o,watch:l,disableValue:e})=>{const t=I(),[c]=Pe(),a=async()=>{var r;return((r=(await c({filter:{}})).data)==null?void 0:r.list)??[]};return s(P,{name:"certificateID",control:o,MySelectProps:{label:t.resources.user.certificate()},disableValue:e,onGetListRecord:a,renderSelectField:({listData:r,formSelectFieldProps:i})=>s(T,{...i,children:r.map(p=>s(v,{value:p.id,children:p.name},p.id))})})},Ke=({control:o,watch:l,disableValue:e})=>{const t=I(),[c]=ye(),a=async()=>{var r;return((r=(await c({filter:{}})).data)==null?void 0:r.list)??[]};return s(P,{name:"departmentID",control:o,required:!0,MySelectProps:{label:t.resources.user.department()},disableValue:e,onGetListRecord:a,renderSelectField:({listData:r,formSelectFieldProps:i})=>s(T,{...i,children:r.map(p=>s(v,{value:p.id,children:p.name},p.id))})})},Xe=({control:o,watch:l,disableValue:e})=>{const t=I(),[c]=_e(),a=async()=>{var r;return((r=(await c({filter:{}})).data)==null?void 0:r.list)??[]};return s(P,{name:"type",control:o,required:!0,MySelectProps:{label:t.resources.user.userType()},disableValue:e,onGetListRecord:a,renderSelectField:({listData:r,formSelectFieldProps:i})=>s(T,{...i,children:r.map(p=>s(v,{value:(p==null?void 0:p.name)||"",children:p.name},p.id))})})},He=o=>{const{name:l,image:e,setValue:t}=o,c=L.useRef(null),[a,r]=L.useState(be(e)),i=()=>{c&&c.current&&c.current.click()},p=L.useCallback(async h=>{const F=h.target.files;if(F){const g=await fe(F[0]);t(l,Ie(g)),r(g)}},[l,t]),m=L.useCallback(()=>{r(""),t(l,"")},[l,t]);return{inputImageRef:c,onSelectImage:i,handleUpImage:p,handleDeleteImage:m,imageSrcTaken:a}},Z=o=>{const l=I(),{name:e,title:t,image:c,setValue:a}=o,{inputImageRef:r,onSelectImage:i,handleUpImage:p,handleDeleteImage:m,imageSrcTaken:h}=He({name:e,image:c,setValue:a});return f(x,{children:[s(Ze,{children:t}),f(Ye,{children:[s(U,{paddingX:1,children:f(U,{spacing:1,children:[s(J,{variant:"outlined",onClick:i,children:l.resources.user.uploadImg()}),s(J,{variant:"outlined",onClick:m,children:l.resources.user.deleteImg()})]})}),s(U,{paddingX:1,width:"100%",children:f(Je,{children:[s("input",{type:"file",hidden:!0,accept:".jpeg, .jpg, .png",ref:r,onChange:p}),s("img",{width:"100%",height:"100%",alt:`${e}_image`,src:h})]})})]})]})},Ze=O(Y)``,J=O(re)``,Je=O(de)`
  min-height: 200px;
  border: 2px solid ${o=>o.theme.palette.background.paper};
`,Ye=O(U)`
  display: grid;
  grid-template-columns: 2fr minmax(250px, 4fr);
`,es=o=>{const{control:l,name:e}=o,{data:t}=N({filter:{}}),c=I();return t?s(W,{name:e,control:l,placeholder:c.resources.user.groupIDs(),enableSelectAll:!0,MyAutoCompleteProps:{size:"small",fullWidth:!0,options:t.list,isOptionEqualToValue:(a,r)=>a.id===r.id,getOptionLabel:a=>typeof a!="string"?`${a==null?void 0:a.id} - ${a==null?void 0:a.name}`:a,renderOption:(a,r,i)=>s("li",{...a,children:f(B,{children:[s(G,{size:"small",checked:i.selected}),r==null?void 0:r.id,"-",r==null?void 0:r.name]})})}}):s(j,{})},oe=o=>{var i,p;const{control:l,onKeyDown:e,record:t,setValue:c,watch:a}=o,r=I();return s(x,{children:f(A,{container:!0,spacing:2,children:[s(A,{item:!0,xs:6,children:f(U,{spacing:2,children:[s(C,{name:"fullname",control:l,MyTextFieldProps:{label:r.resources.user.fullname(),placeholder:r.resources.user.fullname(),fullWidth:!0,required:!0,size:"small",onKeyDown:e}}),s(C,{name:"code",control:l,MyTextFieldProps:{label:r.resources.user.code(),placeholder:r.resources.user.fullname(),fullWidth:!0,required:!0,size:"small",onKeyDown:e}}),s(Ke,{control:l,watch:a,disableValue:((i=t==null?void 0:t.department)==null?void 0:i.name)??""}),s(C,{name:"phone",control:l,MyTextFieldProps:{label:r.resources.user.phone(),placeholder:r.resources.user.phone(),fullWidth:!0,size:"small",onKeyDown:e}}),s(C,{name:"email",control:l,MyTextFieldProps:{label:r.resources.user.email(),placeholder:r.resources.user.email(),fullWidth:!0,size:"small",onKeyDown:e}}),s(Xe,{control:l,watch:a,disableValue:(t==null?void 0:t.type)??""}),f(me,{display:"flex",alignItems:"center",children:[s(pe,{name:"enabled",control:l,render:({field:{...m}})=>s(Fe,{...m,checked:!!m.value})}),s(Y,{children:r.resources.user.enabled()})]}),s(Z,{name:"avatar",title:r.resources.user.avatar(),image:(t==null?void 0:t.avatar)??"",setValue:c})]})}),s(A,{item:!0,xs:6,children:f(U,{spacing:2,children:[s(C,{name:"username",control:l,MyTextFieldProps:{label:r.resources.user.username(),placeholder:r.resources.user.username(),fullWidth:!0,required:!0,size:"small",onKeyDown:e}}),s(C,{name:"password",control:l,MyTextFieldProps:{label:r.resources.user.password(),placeholder:r.resources.user.password(),fullWidth:!0,required:!t,size:"small",onKeyDown:e}}),s(C,{name:"level",control:l,MyTextFieldProps:{label:r.resources.user.level(),placeholder:r.resources.user.level(),fullWidth:!0,size:"small",type:"number",onKeyDown:e}}),s(es,{name:"groups",control:l}),s($e,{name:"roles",control:l}),s(Ne,{name:"modalities",control:l}),s(qe,{control:l,watch:a,disableValue:((p=t==null?void 0:t.certificate)==null?void 0:p.name)??""}),s(Z,{name:"signature",title:r.resources.user.imgSignature(),image:(t==null?void 0:t.signature)??"",setValue:c})]})})]})})},ss=o=>{const{onSuccessCallback:l}=o,e=z(),t=I(),[c]=Me(),{data:a}=_({filter:{}}),r=a==null?void 0:a.list,{modalityData:i,roleData:p,userGroupData:m}=$(),h=w("success",t.messages.titles.createResource({resource:t.resources.user.name().toLowerCase()})),F=w("error",t.messages.titles.createResource({resource:t.resources.user.name().toLowerCase()})),g={mode:"onBlur",criteriaMode:"all",resolver:V(n.object({certificateID:n.number().optional(),code:n.string().trim().min(b,t.messages.validation.genericMinLength({resource:t.resources.user.code(),length:b})).refine(d=>!(r&&r.some(M=>M.code===d)),{message:t.messages.validation.genericDuplicated({name:t.resources.user.code()})}),departmentID:n.number({required_error:t.messages.validation.genericRequired({resource:t.resources.user.department()})}),email:n.string().trim().optional(),enabled:n.boolean().optional(),fullname:n.string().trim().min(b,t.messages.validation.genericMinLength({resource:t.resources.user.fullname(),length:b})),groupIDs:n.array(n.string()).optional(),groups:n.array(n.object({id:n.number()})).optional(),level:n.string().transform(d=>parseInt(d)).optional(),modalityIDs:n.array(n.number()).optional(),modalities:n.array(n.object({id:n.number()})).optional(),roles:n.array(n.object({id:n.string()})).optional(),password:n.string().trim().min(b,t.messages.validation.genericMinLength({resource:t.resources.user.password(),length:b})),phone:n.string().trim().optional(),roleIDs:n.array(n.string()).optional(),avatar:n.string().optional(),signature:n.string().optional(),title:n.string().optional(),type:n.string({required_error:t.messages.validation.genericRequired({resource:t.resources.user.userType()})}),username:n.string().trim().min(b,t.messages.validation.genericMinLength({resource:t.resources.user.username(),length:b})).refine(d=>!(r&&r.some(M=>M.username===d)),{message:t.messages.validation.genericDuplicated({name:t.resources.user.username()})})}).transform(d=>({...d,groupIDs:d.groups?d.groups.map(M=>M.id):void 0,modalityIDs:d.modalities?d.modalities.map(M=>M.id):void 0,roleIDs:d.roles?d.roles.map(M=>M.id):void 0,roles:void 0,groups:void 0,modalities:void 0}))),defaultValues:{username:"",code:"",fullname:"",password:"",groups:[],roles:[],modalities:[]}};return s(te,{registerFormFunctions:d=>e("submitCreateForm",()=>d.submit&&d.submit()),onSubmit:async d=>{try{const M={avatar:d.avatar,certificateID:d.certificateID,code:d.code,departmentID:d.departmentID,email:d.email,fullname:d.fullname,groupIDs:d.groupIDs,level:d.level,modalityIDs:d.modalityIDs,password:d.password,phone:d.phone,roleIDs:d.roleIDs,signature:d.signature,type:d.type,username:d.username,enabled:d.enabled};"error"in await c(M)?F():(h(),l())}catch{F()}},submitOnEnter:!0,formOptions:g,renderInputs:d=>s(oe,{...d,listGroup:(m==null?void 0:m.list)||[],listModality:(i==null?void 0:i.list)||[],listRole:(p==null?void 0:p.list)||[]})})},rs=()=>{const{isOpen:o,open:l,close:e}=ae(!1);return z()("openCreateModal",l),s(ee,{open:o,children:s(ue,{closeModal:e})})},ue=o=>{const{closeModal:l}=o,e=I(),t=k();return s(ne,{confirmLabel:e.buttons.create(),handleClose:l,BodyComponent:s(ss,{onSuccessCallback:l}),handleConfirm:()=>t.submitCreateForm(),title:e.messages.titles.createResource({resource:e.resources.user.name().toLowerCase()}),width:"60%"})};ue.displayName="UserCreateModal";const ts=o=>{var K,X;const{onSuccessCallback:l,record:e,listGroup:t,listModality:c,listRole:a}=o,r=z(),i=I(),[p]=Se(),{data:m}=_({filter:{}}),h=m==null?void 0:m.list.filter(u=>u.id!==e.id),{modalityData:F,roleData:g,userGroupData:y}=$(),d=w("success",i.messages.titles.editResource({resource:i.resources.user.name().toLowerCase()})),M=w("error",i.messages.titles.editResource({resource:i.resources.user.name().toLowerCase()})),q={mode:"onBlur",criteriaMode:"all",resolver:V(n.object({certificateID:n.number().optional(),code:n.string().trim().min(b,i.messages.validation.genericMinLength({resource:i.resources.user.code(),length:b})).refine(u=>!(h&&h.some(S=>S.code===u)),{message:i.messages.validation.genericDuplicated({name:i.resources.user.code()})}),departmentID:n.number({required_error:i.messages.validation.genericRequired({resource:i.resources.user.department()})}),email:n.string().trim().optional(),enabled:n.boolean().optional(),fullname:n.string().trim().min(b,i.messages.validation.genericMinLength({resource:i.resources.user.fullname(),length:b})),groupIDs:n.array(n.string()).optional(),groups:n.array(n.object({id:n.number()})).optional(),level:n.union([n.string(),n.number()]).transform(u=>typeof u=="string"?parseInt(u):u).optional(),modalityIDs:n.array(n.number()).optional(),modalities:n.array(n.object({id:n.number()})).optional(),roles:n.array(n.object({id:n.string()})).optional(),password:n.string().trim().transform(D).refine(u=>typeof u=="string"?u.length>=b:!0,{message:i.messages.validation.genericMinLength({resource:i.resources.user.password(),length:b})}),phone:n.string().trim().optional(),roleIDs:n.array(n.string()).optional(),signature:n.string().optional(),avatar:n.string().optional(),title:n.string().optional(),type:n.string().optional(),username:n.string().trim().min(b,i.messages.validation.genericMinLength({resource:i.resources.user.username(),length:b})).refine(u=>!(h&&h.some(S=>S.username===u)),{message:i.messages.validation.genericDuplicated({name:i.resources.user.username()})})}).transform(u=>({...u,groupIDs:u.groups?u.groups.map(S=>S.id):void 0,modalityIDs:u.modalities?u.modalities.map(S=>S.id):void 0,roleIDs:u.roles?u.roles.map(S=>S.id):void 0,roles:void 0,groups:void 0,modalities:void 0}))),defaultValues:{username:e.username??"",code:e.code??"",fullname:e.fullname??"",password:e.password??"",departmentID:(K=e.department)==null?void 0:K.id,certificateID:((X=e==null?void 0:e.certificate)==null?void 0:X.id)??void 0,level:e.level??void 0,email:e.email??void 0,phone:e.phone??void 0,type:e.type,groups:e==null?void 0:e.groups,modalities:(e==null?void 0:e.modalities)??void 0,roles:e==null?void 0:e.roles,signature:(e==null?void 0:e.signature)??void 0,avatar:(e==null?void 0:e.avatar)??void 0,enabled:(e==null?void 0:e.enabled)??!1}};return s(te,{registerFormFunctions:u=>r("submitEditForm",()=>u.submit&&u.submit()),onSubmit:async u=>{try{const S={id:e.id,certificateID:u.certificateID,code:u.code,departmentID:u.departmentID,email:u.email,fullname:u.fullname,groupIDs:u.groupIDs,level:u.level,modalityIDs:u.modalityIDs,password:u.password,phone:u.phone,roleIDs:u.roleIDs,signature:u.signature,type:u.type,username:u.username,avatar:u.avatar,enabled:u.enabled};"error"in await p(S)?M():(d(),l())}catch{M()}},submitOnEnter:!0,formOptions:q,renderInputs:u=>s(oe,{...u,listGroup:(y==null?void 0:y.list)||[],listModality:(F==null?void 0:F.list)||[],listRole:(g==null?void 0:g.list)||[],record:e})})},as=()=>{const{isOpen:o,open:l,close:e}=ae(!1),t=z(),c=I(),a=ve(),r=Q(Ce(De.USER)),[i]=Le();t("openEditModal",l);const p=w("success",c.messages.titles.deleteResource({resource:c.resources.user.name().toLowerCase()})),m=w("error",c.messages.titles.deleteResource({resource:c.resources.user.name().toLowerCase()})),h=L.useCallback(()=>{r&&a({message:`${c.messages.notification.delete({name:`${r.username}`})}`,options:{variant:"warning",onConfirm:()=>{"error"in i({id:r.id})?m():(p(),e())}}})},[e,i,m,a,p,r,c.messages.notification]);return t("submitDelete",()=>h()),r?s(ee,{open:o,children:s(ce,{closeModal:e,record:r})}):s(x,{})},ce=o=>{const{closeModal:l,record:e}=o,{data:t}=Ue({id:e.id}),c=I(),a=k(),{roleData:r,userGroupData:i,modalityData:p}=$(),m=t&&r&&i&&p;return s(ne,{confirmLabel:c.buttons.update(),handleClose:l,BodyComponent:m?s(ts,{onSuccessCallback:l,record:t,listGroup:i.list,listModality:p.list,listRole:r.list}):s(E,{children:s(ge,{})}),handleConfirm:()=>a.submitEditForm(),title:c.messages.titles.editResource({resource:c.resources.user.name().toLowerCase()}),width:"60%"})};ce.displayName="UserEditModal";const ns={code:"",departmentID:void 0,fullname:"",types:void 0,groupIDs:void 0},ls=()=>{const o=I(),l=Te(),{data:e}=we({filter:{}}),t=e==null?void 0:e.list,{data:c}=N({filter:{}}),a=c==null?void 0:c.list,{data:r}=Qe({filter:{}}),i=r==null?void 0:r.list,[p]=Re(),m=Q(le(R)),h={mode:"onChange",resolver:V(n.object({fullname:n.string().trim().optional().transform(D),code:n.string().trim().optional().transform(D),groupIDs:n.union([n.number(),n.string()]).transform(g=>g?[g]:void 0).optional().transform(D),departmentID:n.union([n.number(),n.string()]).optional().transform(D),type:n.string().trim().optional().transform(D),types:n.array(n.string()).optional()}).transform(g=>({...g,types:g.type?[g.type]:void 0,type:void 0}))),defaultValues:{code:(m==null?void 0:m.filter.code)??"",departmentID:(m==null?void 0:m.filter.departmentID)??void 0,fullname:(m==null?void 0:m.filter.fullname)??"",types:(m==null?void 0:m.filter.types)??void 0,groupIDs:(m==null?void 0:m.filter.groupIDs)??void 0}};return s(xe,{formOptions:h,onSubmit:g=>{l(ze({tableId:R,filter:g})),p({...m,filter:g})},autoSubmit:!0,submitOnEnter:!0,renderInputs:g=>s(Ee,{handleSubmit:g.submit,renderPrimaryField:({open:y,isOpen:d})=>s(Oe,{name:"fullname",control:g.control,handleSubmit:g.submit,handleExpand:y,isExpanded:d,isFormDirty:g.formState.isDirty,resetFormOnDirty:!1,handleReset:()=>g.reset(ns),MyTextFieldProps:{placeholder:o.resources.user.name(),fullWidth:!0,onKeyDown:g.onKeyDown}}),ExtraFieldsComponent:f(x,{children:[s(C,{name:"code",control:g.control,MyTextFieldProps:{label:o.resources.user.code(),placeholder:o.resources.user.code(),fullWidth:!0,onKeyDown:g.onKeyDown}}),f(T,{name:"departmentID",control:g.control,MySelectProps:{label:o.resources.user.department()},children:[s(v,{value:"",children:" "},"null"),t&&t.map(y=>s(v,{value:y.id||"",children:y.name},y.id))]}),f(T,{name:"groupIDs",control:g.control,MySelectProps:{label:o.resources.user.groupIDs()},children:[s(v,{value:"",children:" "},"null"),a&&a.map(y=>s(v,{value:y.id||"",children:y.name},y.id))]}),f(T,{name:"type",control:g.control,MySelectProps:{label:o.resources.user.userType()},children:[s(v,{value:"",children:" "},"null"),i&&i.map(y=>s(v,{value:y.name||"",children:y.name},y.id))]})]})})})},is=o=>{const{FilterComponent:l}=o,e=I(),t=k(),c=Q(le(R)),{data:a,isFetching:r,refetch:i}=_(c||he.skipToken),{open:p}=ke(),m=L.useMemo(()=>[{type:"custom",getColumnDef:h=>h.display({id:"stt",header:e.messages.stt(),cell:F=>s(E,{children:F.row.index+1}),minSize:H,maxSize:H})},{type:"record",name:"id",headerLabel:"ID",renderCell:h=>s(E,{children:h.getValue()}),columnDefOptions:{maxSize:50},enableSort:!0},{type:"record",name:"username",headerLabel:e.resources.user.username(),columnDefOptions:{size:250}},{type:"record",name:"fullname",headerLabel:e.resources.user.fullname(),columnDefOptions:{size:250}},{type:"record",name:"code",headerLabel:e.resources.user.code(),columnDefOptions:{size:150}},{type:"record",name:"phone",headerLabel:e.resources.user.phone(),columnDefOptions:{size:250}},{type:"custom",getColumnDef:h=>h.display({id:"department",header:()=>e.resources.user.department(),cell:F=>{var g,y;return(y=(g=F.row.original)==null?void 0:g.department)==null?void 0:y.name},size:250})},{type:"record",name:"type",headerLabel:e.resources.user.userType(),columnDefOptions:{size:150}},{type:"record",name:"title",headerLabel:e.resources.user.title(),columnDefOptions:{size:250}},{type:"record",name:"level",headerLabel:e.resources.user.level(),columnDefOptions:{size:50}},{type:"record",name:"enabled",headerLabel:e.messages.status.long(),renderCell:h=>s(E,{children:h.getValue()?e.resources.user.enabled():e.resources.user.disabled()}),columnDefOptions:{size:250}}],[e.messages,e.resources.user]);return s(Ae,{children:s(Ge,{tableId:R,data:a==null?void 0:a.list,FilterComponent:l,tableColumnsDescription:m,MyDataGridProps:{isLoading:r,onRowRightClick:h=>{p(h)},onRowDoubleClick(){t.openEditModal()}},paginationControls:{totalRecords:a==null?void 0:a.meta.totalRecords,pageSize:a==null?void 0:a.list.length},TanstackTableOptions:{enableRowSelection:!0,enableMultiRowSelection:!1},renderActionButtons:()=>s(je,{tableId:R,refetch:i})})})},ys=()=>{const o=I(),l=k();return f(Ve,{children:[s(We,{title:o.resources.user.name(),TableComponent:s(is,{FilterComponent:s(ls,{})}),ActionButtons:s(x,{children:s(re,{variant:"contained",onClick:()=>l.openCreateModal(),children:o.buttons.create()})})}),s(Be,{}),s(rs,{}),s(as,{})]})};export{ys as AdminUser};
