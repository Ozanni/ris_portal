import{a as r,j as h,x as O,s as q,ao as T,aF as I,aG as l,S as k,Z as z,T as W,r as S,ag as j,C as ce,F as v,bd as le}from"./vendor-1c7a9a47.js";import{fg as B,cP as de,cQ as ue,cR as G,cS as me,bj as f,e8 as N,fq as U,dm as D,ex as P,fr as pe,ed as R,c8 as F,dn as _,ew as Q,e2 as V,e_ as x,cj as $,bc as H,fs as ye,cd as be,dM as X,ft as he,ca as A,b9 as L,bD as fe,fu as ge,bf as Pe,fv as Me,bm as Y,fw as C,eT as E,f3 as Fe,f4 as Ce,f5 as Te,M as Se,bv as De,cH as Z,c2 as Re,f6 as w,cb as xe,f7 as Ee,f9 as Ae,fa as Ie,fb as ve}from"./index-cdd5c634.js";import{a as J}from"./modalityTypeName-04becb4d.js";import{d as K,a as ee}from"./CheckBoxOutlineBlank-b920c4bc.js";const re=a=>{const{record:c}=a||{},{data:s}=B({filter:{}}),{data:t}=J({filter:{}}),e=s==null?void 0:s.list,i=(e||[]).filter(n=>n.id!==(c==null?void 0:c.id));return{modalityAbbrData:t,listProcedureFiltedred:i,listProcedure:e}},Le=de.injectEndpoints({endpoints:a=>({getListBodyParts:a.query({query:c=>ue(c,"bodyPart"),providesTags:[G.BODY_PART],transformResponse:me})})}),{useGetListBodyPartsQuery:se}=Le,te=a=>{const{control:c,name:s}=a,t=r(K,{fontSize:"small"}),e=r(ee,{fontSize:"small"}),i=f(),{data:n}=se({filter:{}}),d=n==null?void 0:n.list;return r(N,{name:s,control:c,label:i.resources.procedure.bodyParts(),placeholder:i.resources.procedure.bodyParts(),MyAutoCompleteProps:{options:(d==null?void 0:d.map(o=>o.id))||[],fullWidth:!0,isOptionEqualToValue:(o,p)=>o===p,getOptionLabel:o=>o||"",renderOption:(o,p,{selected:y})=>h("li",{...o,children:[r(O,{icon:t,checkedIcon:e,style:{marginRight:8},checked:y}),p]})}})},oe=a=>{const{control:c,materialID:s,quantity:t}=a,e=f(),{data:i}=U({filter:{}}),n=i==null?void 0:i.list;return h(we,{children:[r(D,{name:s,control:c,MySelectProps:{label:e.resources.consumable.title(),placeholder:e.resources.consumable.materialName(),fullWidth:!0},children:n&&(n==null?void 0:n.map(d=>r(T,{value:d.id,children:d.name},d.id)))}),r(P,{control:c,name:t,MyTextFieldProps:{label:e.resources.consumable.quantity(),placeholder:e.resources.consumable.quantity(),size:"small",type:"number",inputProps:{min:0},defaultValue:0}})]})},we=q("div")`
  display: flex;
  flex-direction: row;
  width: 100%;
  gap: ${a=>a.theme.spacing(1)};
`,Oe=a=>{const{onSuccessCallback:c}=a,[s]=pe(),t=f(),e=R(),{modalityAbbrData:i,listProcedure:n}=re(),d={mode:"onChange",criteriaMode:"all",resolver:I(l.object({name:l.string().trim().min(1,t.messages.validation.genericRequired({resource:t.resources.procedure.name()})),code:l.string().trim().min(1,t.messages.validation.genericRequired({resource:t.resources.procedure.code()})).refine(m=>!(n&&n.some(g=>g.code===m)),{message:t.messages.validation.genericDuplicated({name:t.resources.procedure.code()})}),modalityType:l.string().trim().min(1,t.messages.validation.genericRequired({resource:t.resources.modalityType.name()})),dicomDescription:l.string().optional(),bodyParts:l.array(l.string()).optional(),supportAI:l.boolean().optional(),consumables:l.array(l.object({materialID:l.number().optional(),quantity:l.string().transform(m=>Number(m)).optional()})).optional()})),defaultValues:{name:"",code:"",supportAI:!1,modalityType:""}},o=F("success",t.messages.titles.createResource({resource:t.resources.procedure.title().toLowerCase()})),p=F("error",t.messages.titles.createResource({resource:t.resources.procedure.title().toLowerCase()}));return r(_,{registerFormFunctions:m=>e("submitCreateForm",()=>m.submit&&m.submit()),onSubmit:async m=>{try{"error"in await s(m)?p():(o(),c())}catch{p()}},submitOnEnter:!0,formOptions:d,renderInputs:({control:m,formState:g,onKeyDown:u})=>h(k,{spacing:1,alignItems:"start",width:"500px",children:[r(P,{name:"name",control:m,MyTextFieldProps:{label:t.resources.procedure.name(),placeholder:t.resources.procedure.name(),fullWidth:!0,required:!0,size:"small",onKeyDown:u}}),r(P,{name:"code",control:m,MyTextFieldProps:{label:t.resources.procedure.code(),placeholder:t.resources.procedure.code(),fullWidth:!0,required:!0,size:"small",onKeyDown:u}}),r(D,{name:"modalityType",control:m,required:!0,MySelectProps:{label:t.resources.procedure.modalityType(),placeholder:t.resources.procedure.modalityType(),fullWidth:!0},children:i&&(i==null?void 0:i.list.map(b=>r(T,{value:b.id,children:b.id},b.id)))}),r(te,{control:m,name:"bodyParts"}),r(P,{name:"dicomDescription",control:m,MyTextFieldProps:{label:t.resources.procedure.dicomDescription(),placeholder:t.resources.procedure.dicomDescription(),fullWidth:!0,size:"small",onKeyDown:u}}),r(oe,{control:m,materialID:"consumables.0.materialID",quantity:"consumables.0.quantity"}),r(Q,{control:m,render:({value:b,onChange:M})=>h(z,{sx:{display:"flex",alignItems:"center"},children:[r(V,{checked:!!b,onChange:M}),r(W,{children:t.resources.procedure.supportAI()})]}),name:"supportAI"})]})})},qe=()=>{const{isOpen:a,open:c,close:s}=H(!1);return R()("openCreateModal",c),r(j,{open:a,children:r(ae,{closeModal:s})})},ae=S.forwardRef(a=>{const{closeModal:c}=a,s=f(),t=x();return r($,{confirmLabel:s.buttons.create(),handleClose:c,BodyComponent:r(Oe,{onSuccessCallback:c}),handleConfirm:()=>t.submitCreateForm(),title:s.messages.titles.createResource({resource:s.resources.procedure.title().toLowerCase()})})});ae.displayName="ModalRoomCreateModal";const ke=a=>{const{onSuccessCallback:c,record:s}=a,[t]=ye(),e=f(),i=R(),{modalityAbbrData:n,listProcedureFiltedred:d}=re({record:s}),{data:o}=U({filter:{}});o==null||o.list;const p={mode:"onChange",criteriaMode:"all",resolver:I(l.object({name:l.string().trim().min(1,e.messages.validation.genericRequired({resource:e.resources.procedure.name()})),code:l.string().trim().min(1,e.messages.validation.genericRequired({resource:e.resources.procedure.code()})).refine(u=>!(d&&d.some(b=>b.code===u)),{message:e.messages.validation.genericDuplicated({name:e.resources.procedure.code()})}),modalityType:l.string().trim().min(1,e.messages.validation.genericRequired({resource:e.resources.modalityType.name()})),dicomDescription:l.string().optional(),supportAI:l.boolean().optional(),bodyParts:l.array(l.string()).optional(),consumables:l.array(l.object({materialID:l.number().optional(),quantity:l.preprocess(u=>Number(u),l.number()).optional()})).transform(u=>u[0].materialID===void 0?[]:u).optional()})),defaultValues:{code:s.code??"",modalityType:s.modalityType??"",dicomDescription:s.dicomDescription??"",name:s.name??"",supportAI:s.supportAI??!1,bodyParts:(s==null?void 0:s.bodyParts)??[],consumables:(s==null?void 0:s.consumables)??[]}},y=F("success",e.messages.titles.editResource({resource:e.resources.procedure.title().toLowerCase()})),m=F("error",e.messages.titles.editResource({resource:e.resources.procedure.title().toLowerCase()}));return r(_,{registerFormFunctions:u=>i("submitEditForm",()=>u.submit&&u.submit()),onSubmit:async u=>{try{"error"in await t({...u,id:s.id})?m():(y(),c())}catch{m()}},submitOnEnter:!0,formOptions:p,renderInputs:({control:u,onKeyDown:b})=>h(k,{spacing:1,alignItems:"start",width:"500px",children:[r(be,{value:s.id,label:"ID",size:"small",disabled:!0,fullWidth:!0}),r(P,{name:"name",control:u,MyTextFieldProps:{label:e.resources.procedure.name(),placeholder:e.resources.procedure.name(),fullWidth:!0,required:!0,size:"small",onKeyDown:b}}),r(P,{name:"code",control:u,MyTextFieldProps:{label:e.resources.procedure.code(),placeholder:e.resources.procedure.code(),fullWidth:!0,required:!0,size:"small",onKeyDown:b}}),r(D,{name:"modalityType",control:u,required:!0,MySelectProps:{label:e.resources.procedure.modalityType(),placeholder:e.resources.procedure.modalityType(),fullWidth:!0},children:n&&(n==null?void 0:n.list.map(M=>r(T,{value:M.id,children:M.id},M.id)))}),r(te,{control:u,name:"bodyParts"}),r(P,{name:"dicomDescription",control:u,MyTextFieldProps:{label:e.resources.procedure.dicomDescription(),placeholder:e.resources.procedure.dicomDescription(),fullWidth:!0,size:"small",onKeyDown:b}}),r(oe,{control:u,materialID:"consumables.0.materialID",quantity:"consumables.0.quantity"}),r(Q,{control:u,render:({value:M,onChange:ne})=>h(z,{sx:{display:"flex",alignItems:"center"},children:[r(V,{checked:!!M,onChange:ne}),r(W,{children:e.resources.procedure.supportAI()})]}),name:"supportAI"})]})})},ze=()=>{const{isOpen:a,open:c,close:s}=H(!1),t=L(fe(G.PROCEDURE)),e=R();e("openEditModal",c);const i=f(),[n]=ge(),d=X(),o=F("success",i.messages.titles.deleteResource({resource:i.resources.procedure.title().toLowerCase()})),p=F("error",i.messages.titles.deleteResource({resource:i.resources.procedure.title().toLowerCase()})),y=S.useCallback(()=>{t&&d({message:`${i.messages.notification.delete({name:`${t.code}`})}`,options:{variant:"warning",onConfirm:()=>{"error"in n({id:t.id})?p():(o(),s())}}})},[s,n,p,d,o,t,i.messages.notification]);return e("submitDelete",()=>y()),t?r(j,{open:a,children:r(ie,{record:t,closeModal:s})}):r(v,{})},ie=S.forwardRef((a,c)=>{const{closeModal:s,record:t}=a,e=f();X();const i=x(),{data:n}=he({id:t.id});return r($,{ref:c,confirmLabel:e.buttons.update(),handleConfirm:()=>i.submitEditForm(),handleClose:s,BodyComponent:n?r(ke,{record:n,onSuccessCallback:s}):r(A,{children:r(ce,{})}),title:e.messages.titles.editResource({resource:e.resources.procedure.title().toLowerCase()})})});ie.displayName="ProcedureEditModal";const We=a=>{const{control:c,name:s}=a,t=r(K,{fontSize:"small"}),e=r(ee,{fontSize:"small"}),{data:i}=J({filter:{}}),n=i==null?void 0:i.list;return r(N,{name:s,control:c,label:a.label,placeholder:a.placeholder,MyAutoCompleteProps:{options:(n==null?void 0:n.map(d=>d.id))||[],fullWidth:!0,disablePortal:!0,isOptionEqualToValue:(d,o)=>d===o,getOptionLabel:d=>d||"",renderOption:(d,o,{selected:p})=>h("li",{...d,children:[r(O,{icon:t,checkedIcon:e,style:{marginRight:8},checked:p}),o]})}})},je={code:"",name:"",bodyPart:"",modalityTypes:void 0},Be=()=>{const a=f(),c=Pe(),{data:s}=se({filter:{}}),[t]=Me(),e=L(Y(C)),i=s==null?void 0:s.list,n={mode:"onChange",resolver:I(l.object({code:l.string().trim().optional().transform(E),name:l.string().trim().optional().transform(E),bodyPart:l.string().trim().optional().transform(E),modalityTypes:l.array(l.string()).transform(o=>o&&o.length?o:void 0).optional()})),defaultValues:{code:(e==null?void 0:e.filter.code)??"",name:(e==null?void 0:e.filter.name)??"",bodyPart:(e==null?void 0:e.filter.bodyPart)??"",modalityTypes:(e==null?void 0:e.filter.modalityTypes)??void 0}};return r(Fe,{formOptions:n,onSubmit:o=>{c(De({tableId:C,filter:o})),t({...e,filter:o})},submitOnEnter:!0,autoSubmit:!0,renderInputs:o=>r(Ce,{handleSubmit:o.submit,renderPrimaryField:({open:p,isOpen:y})=>r(Te,{name:"name",control:o.control,handleSubmit:o.submit,handleExpand:p,isExpanded:y,isFormDirty:o.formState.isDirty,resetFormOnDirty:!1,handleReset:()=>o.reset(je),MyTextFieldProps:{placeholder:a.resources.procedure.name(),fullWidth:!0,onKeyDown:o.onKeyDown}}),ExtraFieldsComponent:h(v,{children:[r(P,{name:"code",control:o.control,MyTextFieldProps:{label:a.resources.procedure.code(),placeholder:a.resources.procedure.code(),fullWidth:!0,onKeyDown:o.onKeyDown}}),r(We,{label:a.resources.modality.modalityType.long(),placeholder:a.resources.modality.modalityType.long(),control:o.control,name:"modalityTypes"},Se()),h(D,{name:"bodyPart",control:o.control,MySelectProps:{label:a.resources.procedure.bodyParts()},children:[r(T,{value:"",children:"Â "},"null"),i&&i.map(p=>r(T,{value:p.id||"",children:p.id},p.id))]})]})})})},Ge=a=>{const{FilterComponent:c}=a,s=f(),t=L(Y(C)),{data:e,isFetching:i,refetch:n}=B(t||le.skipToken),d=x(),{open:o}=Re(),p=S.useMemo(()=>[{type:"custom",getColumnDef:y=>y.display({id:"stt",header:s.messages.stt(),cell:m=>r(A,{children:m.row.index+1}),minSize:w,maxSize:w})},{type:"record",name:"id",headerLabel:"ID",renderCell:y=>r(A,{children:y.getValue()}),columnDefOptions:{maxSize:150},enableSort:!0},{type:"record",name:"code",headerLabel:s.resources.procedure.code(),columnDefOptions:{size:250}},{type:"record",name:"modalityType",headerLabel:s.resources.procedure.modalityType(),columnDefOptions:{size:250}},{type:"custom",getColumnDef:y=>y.display({id:"bodyParts",header:()=>s.resources.procedure.bodyParts(),cell:m=>{var g,u;return((g=m.row.original)==null?void 0:g.bodyParts)&&((u=m.row.original)==null?void 0:u.bodyParts.map(b=>b).join(","))},size:250})},{type:"record",name:"name",headerLabel:s.resources.procedure.name(),columnDefOptions:{size:750}}],[s.messages,s.resources.procedure]);return r(xe,{tableId:C,data:e==null?void 0:e.list,FilterComponent:c,tableColumnsDescription:p,MyDataGridProps:{isLoading:i,onRowRightClick:y=>{o(y)},onRowDoubleClick(){d.openEditModal()}},paginationControls:{totalRecords:e==null?void 0:e.meta.totalRecords,pageSize:e==null?void 0:e.list.length},TanstackTableOptions:{enableRowSelection:!0,enableMultiRowSelection:!1},renderActionButtons:()=>r(Ee,{tableId:C,refetch:n})})};q(Z)`
  border: 0;
  &:hover {
    border: 0;
  }
`;const Ve=()=>{const a=f(),c=x();return h(Ae,{children:[r(Ie,{title:a.resources.procedure.title(),TableComponent:r(Ge,{FilterComponent:r(Be,{})}),ActionButtons:r(v,{children:r(Z,{variant:"contained",onClick:()=>c.openCreateModal(),children:a.buttons.create()})})}),r(qe,{}),r(ze,{}),r(ve,{})]})};export{Ve as AdminProcedure};
