import{j as G,S as re,a as r,x as E,b as O,aF as $,aG as c,r as T,ag as N,F as A,C as te,bd as oe}from"./vendor-1c7a9a47.js";import{cP as x,cQ as _,cR as M,cS as B,bj as h,cd as ne,ex as W,e8 as U,e9 as F,ed as z,c8 as D,dn as H,e_ as P,cj as Y,bc as Q,ca as I,b9 as k,bD as K,dM as le,bm as X,f_ as q,e6 as ie,f6 as w,cb as J,f7 as Z,f$ as j,c2 as ae,f9 as ce,fa as ue,cH as de,fb as me}from"./index-cdd5c634.js";import{u as pe,a as ge,b as be,c as ye,d as he,e as Ce}from"./userGroup-c97bc4e8.js";import{u as Me}from"./role-14050e4a.js";import{C as fe}from"./CollapsiblePanel-1b32f69e.js";const Re=x.injectEndpoints({endpoints:n=>({getListModality:n.query({query:o=>_(o,M.MODALITY),providesTags:[M.MODALITY],transformResponse:B})})}),{useGetListModalityQuery:Se}=Re,Ge=x.injectEndpoints({endpoints:n=>({getListModule:n.query({query:o=>_(o,"module"),providesTags:(o={list:[],meta:{totalRecords:0}})=>[{type:M.MODULE},...o.list.map(s=>({type:M.MODULE,id:s.id}))],transformResponse:B})})}),{useGetListModuleQuery:Ie}=Ge,De=x.injectEndpoints({endpoints:n=>({getListStatisticsReport:n.query({query:o=>_(o,M.STATISTICS_REPORT),providesTags:(o={list:[],meta:{totalRecords:0}})=>[{type:M.STATISTICS_REPORT},...o.list.map(s=>({type:M.STATISTICS_REPORT,id:s.id}))],transformResponse:B})})}),{useGetListStatisticsReportQuery:Le}=De,V=()=>{const{data:n}=Se({filter:{}}),{data:o}=Me({filter:{}}),{data:s}=Ie({filter:{}}),{data:i}=Le({filter:{}}),l=n==null?void 0:n.list,m=o==null?void 0:o.list,u=s==null?void 0:s.list,b=i==null?void 0:i.list;return{listModality:l,listRole:m,listModule:u,listReport:b}},v=n=>{const{record:o,control:s,onKeyDown:i,listModality:l,listRole:m,listModule:u,listReport:b}=n,a=h();return G(re,{spacing:1,children:[o&&r(ne,{value:o.id,label:"ID",disabled:!0,fullWidth:!0,size:"small"}),r(W,{name:"name",control:s,MyTextFieldProps:{label:a.resources.group.name.short(),placeholder:a.resources.group.name.short(),fullWidth:!0,required:!0,size:"small",onKeyDown:i}}),u?r(U,{name:"modules",control:s,placeholder:a.resources.group.module.long(),enableSelectAll:!0,MyAutoCompleteProps:{size:"small",fullWidth:!0,options:u,isOptionEqualToValue:(e,t)=>(e==null?void 0:e.id)===(t==null?void 0:t.id),getOptionLabel:e=>(e==null?void 0:e.name)||"",renderOption:(e,t,p)=>r("li",{...e,children:G(F,{children:[r(E,{size:"small",checked:p.selected}),t==null?void 0:t.name]})})}}):r(O,{}),l?r(U,{name:"modalities",control:s,placeholder:a.resources.group.modality(),enableSelectAll:!0,MyAutoCompleteProps:{size:"small",fullWidth:!0,options:l,isOptionEqualToValue:(e,t)=>(e==null?void 0:e.id)===(t==null?void 0:t.id),getOptionLabel:e=>typeof e!="string"?`${e.modalityType} - ${e==null?void 0:e.name}`:e,renderOption:(e,t,p)=>r("li",{...e,children:G(F,{children:[r(E,{size:"small",checked:p.selected}),t==null?void 0:t.modalityType,"-",t==null?void 0:t.name]})})}}):r(O,{}),m?r(U,{name:"roles",control:s,placeholder:a.resources.group.role(),enableSelectAll:!0,MyAutoCompleteProps:{size:"small",fullWidth:!0,options:m,isOptionEqualToValue:(e,t)=>(e==null?void 0:e.id)===(t==null?void 0:t.id),getOptionLabel:e=>(e==null?void 0:e.name)||"",renderOption:(e,t,p)=>r("li",{...e,children:G(F,{children:[r(E,{size:"small",checked:p.selected}),t==null?void 0:t.name]})})}}):r(O,{}),b?r(U,{name:"reports",control:s,placeholder:a.resources.group.report(),enableSelectAll:!0,MyAutoCompleteProps:{size:"small",fullWidth:!0,options:b,isOptionEqualToValue:(e,t)=>(e==null?void 0:e.id)===(t==null?void 0:t.id),getOptionLabel:e=>(e==null?void 0:e.name)||"",renderOption:(e,t,p)=>r("li",{...e,children:G(F,{children:[r(E,{size:"small",checked:p.selected}),t==null?void 0:t.name]})})}}):r(O,{}),r(W,{name:"description",control:s,MyTextFieldProps:{label:a.resources.group.description(),placeholder:a.resources.group.description(),fullWidth:!0,size:"small",onKeyDown:i,rows:3,multiline:!0}})]})},Te=n=>{const o=h(),{onSuccessCallback:s}=n,[i]=pe(),l=z(),{listModality:m,listRole:u,listModule:b,listReport:a}=V(),e=D("success",o.messages.titles.createResource({resource:o.resources.group.title().toLowerCase()})),t=D("error",o.messages.titles.createResource({resource:o.resources.group.title().toLowerCase()})),p={criteriaMode:"all",resolver:$(c.object({name:c.string().trim().min(3,o.messages.validation.genericMinLength({resource:o.resources.group.name.long(),length:3})),description:c.string().optional(),modalities:c.array(c.object({id:c.number()})).optional(),modules:c.array(c.object({id:c.number()})).optional(),roles:c.array(c.object({id:c.string()})).optional(),reports:c.array(c.object({id:c.string()})).optional()}).transform(g=>{var d,C,S,L;return{...g,modalityIDs:(d=g.modalities)==null?void 0:d.map(y=>y.id),moduleIDs:(C=g.modules)==null?void 0:C.map(y=>y.id),roleIDs:(S=g.roles)==null?void 0:S.map(y=>y.id),reportIDs:(L=g.reports)==null?void 0:L.map(y=>y.id)}})),defaultValues:{name:"",description:"",modalities:[],modules:[],roles:[],modalityIDs:[],moduleIDs:[],reportIDs:[],roleIDs:[]}};return r(H,{registerFormFunctions:g=>l("submitCreateForm",()=>g.submit&&g.submit()),formOptions:p,submitOnEnter:!0,onSubmit:async g=>{try{const d={name:g.name,description:g.description||"",modalityIDs:g.modalityIDs,moduleIDs:g.moduleIDs,reportIDs:g.reportIDs,roleIDs:g.roleIDs};"error"in await i(d)?t():(e(),s())}catch{t()}},renderInputs:g=>r(v,{listModality:m,listRole:u,listModule:b,listReport:a,...g})})},Ee=()=>{const{isOpen:n,open:o,close:s}=Q(!1);return z()("openCreateModal",o),r(N,{disableEnforceFocus:!0,open:n,children:r(ee,{closeModal:s})})},ee=T.forwardRef((n,o)=>{const{closeModal:s}=n,i=h(),l=P();return r(Y,{ref:o,confirmLabel:i.buttons.create(),handleClose:s,BodyComponent:r(Te,{onSuccessCallback:s}),handleConfirm:()=>l.submitCreateForm(),title:i.messages.titles.createResource({resource:i.resources.group.title().toLowerCase()}),width:"40%"})});ee.displayName="UserGroupCreateModal";const Oe=n=>{const{record:o,onSuccessCallback:s}=n,[i]=ge(),l=h(),m=z(),{listModality:u,listRole:b,listModule:a,listReport:e}=V(),t=D("success",l.messages.titles.editResource({resource:l.resources.group.title().toLowerCase()})),p=D("error",l.messages.titles.editResource({resource:l.resources.group.title().toLowerCase()})),R={criteriaMode:"all",resolver:$(c.object({name:c.string().trim().min(3,l.messages.validation.genericMinLength({resource:l.resources.group.name.long(),length:3})),description:c.string().optional(),modalities:c.array(c.object({id:c.number()})).optional(),modules:c.array(c.object({id:c.number()})).optional(),roles:c.array(c.object({id:c.string()})).optional(),reports:c.array(c.object({id:c.string()})).optional()}).transform(d=>{var C,S,L,y;return{...d,modalityIDs:(C=d.modalities)==null?void 0:C.map(f=>f.id),moduleIDs:(S=d.modules)==null?void 0:S.map(f=>f.id),roleIDs:(L=d.roles)==null?void 0:L.map(f=>f.id),reportIDs:(y=d.reports)==null?void 0:y.map(f=>f.id)}})),defaultValues:{name:o.name||"",description:o.description||"",modalities:o.modalities||[],modules:o.modules||[],roles:o.roles||[],modalityIDs:[],moduleIDs:[],roleIDs:[]}};return r(H,{registerFormFunctions:d=>m("submitEditForm",()=>d.submit&&d.submit()),formOptions:R,submitOnEnter:!0,onSubmit:async d=>{try{const C={name:d.name,modalityIDs:d.modalityIDs,moduleIDs:d.moduleIDs,roleIDs:d.roleIDs,id:o.id,description:d.description||""};"error"in await i({...C})?p():(t(),s())}catch{p()}},renderInputs:d=>r(v,{listModality:u,record:o,listRole:b,listModule:a,listReport:e,...d})})},Ue=()=>{const{isOpen:n,open:o,close:s}=Q(!1),i=k(K(M.USER_GROUP)),[l]=ye(),[m]=he(),u=h(),b=le(),a=z();a("openEditModal",o);const e=D("success",u.messages.titles.deleteResource({resource:u.resources.group.title().toLowerCase()})),t=D("error",u.messages.titles.deleteResource({resource:u.resources.group.title().toLowerCase()})),p=T.useCallback(async()=>{if(i){const R=await m({id:i.id}).unwrap();b({message:`${u.messages.notification.delete({name:`${R==null?void 0:R.name}`})}`,options:{variant:"warning",onConfirm:async()=>{"error"in await l({id:i.id})?t():(e(),s())}}})}},[s,l,m,t,b,e,i,u.messages.notification]);return a("submitDelete",()=>p()),i?r(N,{disableEnforceFocus:!0,open:n,children:r(se,{record:i,closeModal:s})}):r(A,{})},se=T.forwardRef((n,o)=>{const{closeModal:s,record:i}=n,l=h(),m=P(),{data:u}=be({id:i.id}),{listModality:b,listRole:a,listModule:e}=V();return r(A,{children:r(Y,{ref:o,confirmLabel:l.buttons.update(),handleConfirm:()=>m.submitEditForm(),handleClose:s,BodyComponent:u&&b&&a&&e?r(Oe,{record:u,onSuccessCallback:s}):r(I,{children:r(te,{})}),title:l.messages.titles.editResource({resource:l.resources.group.title().toLowerCase()}),width:"40%"})})});se.displayName="UserGroupEditModal";const Fe=n=>{const{userGroupId:o}=n,s=h(),i=k(X(q)),{data:l,isFetching:m,refetch:u}=ie({...i,filter:{groupIDs:[o]}}),b=T.useMemo(()=>[{type:"custom",getColumnDef:a=>a.display({id:"stt",header:s.messages.stt(),cell:e=>r(I,{children:e.row.index+1}),minSize:w,maxSize:w})},{type:"record",name:"fullname",headerLabel:s.resources.user.fullname()},{type:"record",name:"code",headerLabel:s.resources.user.code()},{type:"record",name:"username",headerLabel:s.resources.user.username()},{type:"custom",getColumnDef:a=>a.display({id:"department",header:()=>s.resources.user.department(),cell:e=>{var t,p;return(p=(t=e.row.original)==null?void 0:t.department)==null?void 0:p.name}})},{type:"record",name:"type",headerLabel:s.resources.group.memberObject()},{type:"record",name:"enabled",headerLabel:s.messages.status.long(),renderCell:a=>r(I,{children:a.getValue()?s.resources.user.enabled():s.resources.user.disabled()}),columnDefOptions:{size:250}}],[s.resources.user,s.resources.group,s.messages.status]);return r(J,{tableId:q,data:l==null?void 0:l.list,tableColumnsDescription:b,paginationControls:{totalRecords:l==null?void 0:l.meta.totalRecords,pageSize:l==null?void 0:l.list.length},MyDataGridProps:{isLoading:m},TanstackTableOptions:{enableRowSelection:!1,enableMultiRowSelection:!1},renderActionButtons:()=>r(Z,{tableId:q,refetch:u,hideButtonAdd:!0,hideButtonDelete:!0,hideButtonEdit:!0})})},we=()=>{const n=k(K(M.USER_GROUP)),{isOpen:o,open:s,close:i}=Q(!0),l=n==null?void 0:n.id,m=n==null?void 0:n.name,u=h();return l?r(fe,{initialExpanded:o,onExpand:s,onCollapse:i,onClose:i,title:u.messages.titles.userGroupMemberList({userGroup:m||""}),children:r(Fe,{userGroupId:l})},l):r(A,{})},Ae=()=>{const n=h(),o=k(X(j)),{data:s,isFetching:i,refetch:l}=Ce(o||oe.skipToken),m=P(),{open:u}=ae(),b=T.useMemo(()=>[{type:"custom",getColumnDef:a=>a.display({id:"stt",header:n.messages.stt(),cell:e=>r(I,{children:e.row.index+1}),minSize:w,maxSize:w})},{type:"record",name:"id",headerLabel:"ID",renderCell:a=>r(I,{children:a.getValue()}),columnDefOptions:{size:50},enableSort:!0},{type:"record",name:"name",headerLabel:n.resources.group.name.short(),columnDefOptions:{size:300}},{type:"custom",getColumnDef:a=>a.display({id:"modules",header:n.resources.group.module.short(),cell:e=>{var t;return r(I,{children:(t=e.row.original.modules)==null?void 0:t.map(p=>p.name).join(",")})},size:600})},{type:"record",name:"description",headerLabel:n.resources.group.description(),columnDefOptions:{size:700}}],[n.messages,n.resources.group]);return r(J,{tableId:j,data:s==null?void 0:s.list,tableColumnsDescription:b,MyDataGridProps:{isLoading:i,onRowRightClick:a=>{u(a)},onRowDoubleClick(){m.openEditModal()}},paginationControls:{totalRecords:s==null?void 0:s.meta.totalRecords,pageSize:s==null?void 0:s.list.length},TanstackTableOptions:{enableRowSelection:!0,enableMultiRowSelection:!1},renderActionButtons:()=>r(Z,{tableId:j,refetch:l})})},xe=()=>{const n=h(),o=P();return G(ce,{children:[r(ue,{title:n.resources.group.title(),TableComponent:r(Ae,{}),PanelComponent:r(we,{}),ActionButtons:r(A,{children:r(de,{variant:"contained",onClick:()=>o.openCreateModal(),children:n.buttons.create()})})}),r(me,{}),r(Ee,{}),r(Ue,{})]})};export{xe as AdminUserGroup};
